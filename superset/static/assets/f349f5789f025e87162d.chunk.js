/*! For license information please see f349f5789f025e87162d.chunk.js.LICENSE */
(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{3518:function(t,e,i){var n;!function(a,o,s){if(a){for(var r,l={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},h={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},u={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},c={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},d=1;d<20;++d)l[111+d]="f"+d;for(d=0;d<=9;++d)l[d+96]=d.toString();y.prototype.bind=function(t,e,i){return t=t instanceof Array?t:[t],this._bindMultiple.call(this,t,e,i),this},y.prototype.unbind=function(t,e){return this.bind.call(this,t,(function(){}),e)},y.prototype.trigger=function(t,e){return this._directMap[t+":"+e]&&this._directMap[t+":"+e]({},t),this},y.prototype.reset=function(){return this._callbacks={},this._directMap={},this},y.prototype.stopCallback=function(t,e){return!((" "+e.className+" ").indexOf(" mousetrap ")>-1)&&(!function t(e,i){return null!==e&&e!==o&&(e===i||t(e.parentNode,i))}(e,this.target)&&("INPUT"==e.tagName||"SELECT"==e.tagName||"TEXTAREA"==e.tagName||e.isContentEditable))},y.prototype.handleKey=function(){var t=this;return t._handleKey.apply(t,arguments)},y.addKeycodes=function(t){for(var e in t)t.hasOwnProperty(e)&&(l[e]=t[e]);r=null},y.init=function(){var t=y(o);for(var e in t)"_"!==e.charAt(0)&&(y[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e))},y.init(),a.Mousetrap=y,t.exports&&(t.exports=y),void 0===(n=function(){return y}.call(e,i,e,t))||(t.exports=n)}function p(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)}function g(t){if("keypress"==t.type){var e=String.fromCharCode(t.which);return t.shiftKey||(e=e.toLowerCase()),e}return l[t.which]?l[t.which]:h[t.which]?h[t.which]:String.fromCharCode(t.which).toLowerCase()}function f(t){return"shift"==t||"ctrl"==t||"alt"==t||"meta"==t}function v(t,e,i){return i||(i=function(){if(!r)for(var t in r={},l)t>95&&t<112||l.hasOwnProperty(t)&&(r[l[t]]=t);return r}()[t]?"keydown":"keypress"),"keypress"==i&&e.length&&(i="keydown"),i}function m(t,e){var i,n,a,o=[];for(i=function(t){return"+"===t?["+"]:(t=t.replace(/\+{2}/g,"+plus")).split("+")}(t),a=0;a<i.length;++a)n=i[a],c[n]&&(n=c[n]),e&&"keypress"!=e&&u[n]&&(n=u[n],o.push("shift")),f(n)&&o.push(n);return{key:n,modifiers:o,action:e=v(n,o,e)}}function y(t){var e=this;if(t=t||o,!(e instanceof y))return new y(t);e.target=t,e._callbacks={},e._directMap={};var i,n={},a=!1,s=!1,r=!1;function l(t){t=t||{};var e,i=!1;for(e in n)t[e]?i=!0:n[e]=0;i||(r=!1)}function h(t,i,a,o,s,r){var l,h,u,c,d=[],p=a.type;if(!e._callbacks[t])return[];for("keyup"==p&&f(t)&&(i=[t]),l=0;l<e._callbacks[t].length;++l)if(h=e._callbacks[t][l],(o||!h.seq||n[h.seq]==h.level)&&p==h.action&&("keypress"==p&&!a.metaKey&&!a.ctrlKey||(u=i,c=h.modifiers,u.sort().join(",")===c.sort().join(",")))){var g=!o&&h.combo==s,v=o&&h.seq==o&&h.level==r;(g||v)&&e._callbacks[t].splice(l,1),d.push(h)}return d}function u(t,i,n,a){e.stopCallback(i,i.target||i.srcElement,n,a)||!1===t(i,n)&&(function(t){t.preventDefault?t.preventDefault():t.returnValue=!1}(i),function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}(i))}function c(t){"number"!=typeof t.which&&(t.which=t.keyCode);var i=g(t);i&&("keyup"!=t.type||a!==i?e.handleKey(i,function(t){var e=[];return t.shiftKey&&e.push("shift"),t.altKey&&e.push("alt"),t.ctrlKey&&e.push("ctrl"),t.metaKey&&e.push("meta"),e}(t),t):a=!1)}function d(t,e,o,s){function h(e){return function(){r=e,++n[t],clearTimeout(i),i=setTimeout(l,1e3)}}function c(e){u(o,e,t),"keyup"!==s&&(a=g(e)),setTimeout(l,10)}n[t]=0;for(var d=0;d<e.length;++d){var p=d+1===e.length?c:h(s||m(e[d+1]).action);v(e[d],p,s,t,d)}}function v(t,i,n,a,o){e._directMap[t+":"+n]=i;var s,r=(t=t.replace(/\s+/g," ")).split(" ");r.length>1?d(t,r,i,n):(s=m(t,n),e._callbacks[s.key]=e._callbacks[s.key]||[],h(s.key,s.modifiers,{type:s.action},a,t,o),e._callbacks[s.key][a?"unshift":"push"]({callback:i,modifiers:s.modifiers,action:s.action,seq:a,level:o,combo:t}))}e._handleKey=function(t,e,i){var n,a=h(t,e,i),o={},c=0,d=!1;for(n=0;n<a.length;++n)a[n].seq&&(c=Math.max(c,a[n].level));for(n=0;n<a.length;++n)if(a[n].seq){if(a[n].level!=c)continue;d=!0,o[a[n].seq]=1,u(a[n].callback,i,a[n].combo,a[n].seq)}else d||u(a[n].callback,i,a[n].combo);var p="keypress"==i.type&&s;i.type!=r||f(t)||p||l(o),s=d&&"keydown"==i.type},e._bindMultiple=function(t,e,i){for(var n=0;n<t.length;++n)v(t[n],e,i)},p(t,"keypress",c),p(t,"keydown",c),p(t,"keyup",c)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)},4296:function(t,e,i){"use strict";i.d(e,"a",(function(){return F}));var n=i(19),a=i(13),o=i(22),s=i(24),r=i(4325);function l(t,e){var i=r.c([],e,t);return r.b(i,i,1/i[3]),i}var h=i(4298),u=i(4286),c=i(4323);function d(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}var p=Math.PI,g=p/4,f=p/180,v=180/p;function m(t){return Math.pow(2,t)}function y(t){var e=Object(a.a)(t,2),i=e[0],n=e[1];d(Number.isFinite(i)),d(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");var o=n*f;return[512*(i*f+p)/(2*p),512*(p+Math.log(Math.tan(g+.5*o)))/(2*p)]}function b(t){var e=Object(a.a)(t,2),i=e[0],n=e[1],o=i/512*(2*p)-p,s=2*(Math.atan(Math.exp(n/512*(2*p)-p))-g);return[o*v,s*v]}function _(t){var e=t.latitude,i=t.longitude,n=t.highPrecision,a=void 0!==n&&n;d(Number.isFinite(e)&&Number.isFinite(i));var o={},s=Math.cos(e*f),r=512/360/s,l=512/4003e4/s;if(o.unitsPerMeter=[l,l,l],o.metersPerUnit=[1/l,1/l,1/l],o.unitsPerDegree=[512/360,r,l],o.degreesPerUnit=[.703125,1/r,1/l],a){var h=f*Math.tan(e*f)/s,u=512/360*h/2,c=512/4003e4*h,p=c/r*l;o.unitsPerDegree2=[0,u,c],o.unitsPerMeter2=[p,0,p]}return o}function x(t){var e=t.height,i=t.pitch,n=t.bearing,a=t.altitude,o=t.scale,s=t.center,r=void 0===s?null:s,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return h.o(l,l,[0,0,-a]),h.k(l,l,-i*f),h.m(l,l,n*f),o/=e,h.n(l,l,[o,o,o]),r&&h.o(l,l,c.d([],r)),l}function w(t){var e=t.width,i=t.height,n=t.pitch,a=function(t){var e=t.width,i=t.height,n=t.altitude,a=void 0===n?1.5:n,o=t.pitch,s=void 0===o?0:o,r=t.nearZMultiplier,l=void 0===r?1:r,h=t.farZMultiplier,u=void 0===h?1:h,c=s*f,d=Math.atan(.5/a),p=Math.sin(d)*a/Math.sin(Math.min(Math.max(Math.PI/2-c-d,.01),Math.PI-.01));return{fov:2*d,aspect:e/i,focalDistance:a,near:l,far:(Math.sin(c)*p+a)*u}}({width:e,height:i,altitude:t.altitude,pitch:n,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier}),o=a.fov,s=a.aspect,r=a.near,l=a.far;return h.i([],o,s,r,l)}function C(t,e){var i=Object(a.a)(t,3),n=i[0],o=i[1],s=i[2],r=void 0===s?0:s;return d(Number.isFinite(n)&&Number.isFinite(o)&&Number.isFinite(r)),l(e,[n,o,r,1])}function M(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=Object(a.a)(t,3),o=n[0],s=n[1],r=n[2];if(d(Number.isFinite(o)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(r)){var h=l(e,[o,s,r,1]);return h}var c=l(e,[o,s,0,1]),p=l(e,[o,s,1,1]),g=c[2],f=p[2],v=g===f?0:((i||0)-g)/(f-g);return u.d([],c,p,v)}function k(t){var e=t.width,i=t.height,n=t.bounds,o=t.minExtent,s=void 0===o?0:o,r=t.maxZoom,l=void 0===r?24:r,h=t.padding,u=void 0===h?0:h,c=t.offset,p=void 0===c?[0,0]:c,g=Object(a.a)(n,2),f=Object(a.a)(g[0],2),v=f[0],m=f[1],y=Object(a.a)(g[1],2),b=y[0],_=y[1];if(Number.isFinite(u)){u={top:u,bottom:u,left:u,right:u}}else d(Number.isFinite(u.top)&&Number.isFinite(u.bottom)&&Number.isFinite(u.left)&&Number.isFinite(u.right));var x=new O({width:e,height:i,longitude:0,latitude:0,zoom:0}),w=x.project([v,_]),C=x.project([b,m]),M=[Math.max(Math.abs(C[0]-w[0]),s),Math.max(Math.abs(C[1]-w[1]),s)],k=[e-u.left-u.right-2*Math.abs(p[0]),i-u.top-u.bottom-2*Math.abs(p[1])];d(k[0]>0&&k[1]>0);var P=k[0]/M[0],S=k[1]/M[1],E=(u.right-u.left)/2/P,j=(u.bottom-u.top)/2/S,A=[(C[0]+w[0])/2+E,(C[1]+w[1])/2+j],L=x.unproject(A),D=Math.min(l,x.zoom+Math.log2(Math.abs(Math.min(P,S))));return d(Number.isFinite(D)),{longitude:L[0],latitude:L[1],zoom:D}}var P=Math.PI/180;function S(t){var e,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=t.width,o=t.height,s=t.unproject,r={targetZ:n},l=s([0,o],r),h=s([a,o],r),u=Math.atan(.5/t.altitude),c=(90-t.pitch)*P;return u>c-.01?(e=E(t,0,n),i=E(t,a,n)):(e=s([0,0],r),i=s([a,0],r)),[l,h,i,e]}function E(t,e,i){var n=t.pixelUnprojectionMatrix,a=l(n,[e,0,1,1]),o=l(n,[e,t.height,1,1]),s=(i*t.distanceScales.unitsPerMeter[2]-a[2])/(o[2]-a[2]),r=b(u.d([],a,o,s));return r[2]=i,r}var O=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{width:1,height:1},i=e.width,n=e.height,a=e.latitude,s=void 0===a?0:a,r=e.longitude,l=void 0===r?0:r,h=e.zoom,u=void 0===h?0:h,c=e.pitch,d=void 0===c?0:c,p=e.bearing,g=void 0===p?0:p,f=e.altitude,v=void 0===f?1.5:f,b=e.nearZMultiplier,C=void 0===b?.02:b,M=e.farZMultiplier,k=void 0===M?1.01:M;Object(o.a)(this,t),i=i||1,n=n||1;var P=m(u);v=Math.max(.75,v);var S=y([l,s]);S[2]=0,this.projectionMatrix=w({width:i,height:n,pitch:d,altitude:v,nearZMultiplier:C,farZMultiplier:k}),this.viewMatrix=x({height:n,scale:P,center:S,pitch:d,bearing:g,altitude:v}),this.width=i,this.height=n,this.scale=P,this.latitude=s,this.longitude=l,this.zoom=u,this.pitch=d,this.bearing=g,this.altitude=v,this.center=S,this.distanceScales=_(this),this._initMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),Object.freeze(this)}return Object(s.a)(t,[{key:"_initMatrices",value:function(){var t=this.width,e=this.height,i=this.projectionMatrix,n=this.viewMatrix,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];h.g(a,a,i),h.g(a,a,n),this.viewProjectionMatrix=a;var o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];h.n(o,o,[t/2,-e/2,1]),h.o(o,o,[1,-1,0]),h.g(o,o,a);var s=h.e([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o);if(!s)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=o,this.pixelUnprojectionMatrix=s}},{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&h.b(e.projectionMatrix,this.projectionMatrix)&&h.b(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.topLeft,n=void 0===i||i,o=this.projectPosition(t),s=C(o,this.pixelProjectionMatrix),r=Object(a.a)(s,2),l=r[0],h=r[1],u=n?h:this.height-h;return 2===t.length?[l,u]:[l,u,s[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.topLeft,n=void 0===i||i,o=e.targetZ,s=void 0===o?void 0:o,r=Object(a.a)(t,3),l=r[0],h=r[1],u=r[2],c=n?h:this.height-h,d=s&&s*this.distanceScales.unitsPerMeter[2],p=M([l,c,u],this.pixelUnprojectionMatrix,d),g=this.unprojectPosition(p),f=Object(a.a)(g,3),v=f[0],m=f[1],y=f[2];return Number.isFinite(u)?[v,m,y]:Number.isFinite(s)?[v,m,s]:[v,m]}},{key:"projectPosition",value:function(t){var e=y(t),i=Object(a.a)(e,2);return[i[0],i[1],(t[2]||0)*this.distanceScales.unitsPerMeter[2]]}},{key:"unprojectPosition",value:function(t){var e=b(t),i=Object(a.a)(e,2);return[i[0],i[1],(t[2]||0)*this.distanceScales.metersPerUnit[2]]}},{key:"projectFlat",value:function(t){return y(t)}},{key:"unprojectFlat",value:function(t){return b(t)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,i=M(t.pos,this.pixelUnprojectionMatrix),n=y(e),a=u.a([],n,u.e([],i));return b(u.a([],this.center,a))}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,i=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:i})}},{key:"fitBounds",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.width,a=this.height,o=k(Object.assign({width:n,height:a,bounds:e},i)),s=o.longitude,r=o.latitude,l=o.zoom;return new t({width:n,height:a,longitude:s,latitude:r,zoom:l})}},{key:"getBounds",value:function(t){var e=this.getBoundingRegion(t),i=Math.min.apply(Math,Object(n.a)(e.map((function(t){return t[0]})))),a=Math.max.apply(Math,Object(n.a)(e.map((function(t){return t[0]}))));return[[i,Math.min.apply(Math,Object(n.a)(e.map((function(t){return t[1]}))))],[a,Math.max.apply(Math,Object(n.a)(e.map((function(t){return t[1]}))))]]}},{key:"getBoundingRegion",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return S(this,t.z||0)}}]),t}();var j=i(580);const A=[-90,90],L=[-180,180];function D(t,e,i){let[n,a]=t,[o,s]=e;return void 0===i&&(i=.25),n<a?[n,a]:[Math.max(o,n-i),Math.min(s,a+i)]}function T(){return(T=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function F(t,e){let{points:i,width:n,height:a,minExtent:o,maxZoom:s,offset:r,padding:l=20}=e;const{bearing:h,pitch:u}=t,c=function(t){const e=D(Object(j.extent)(t,t=>t[1]),A),i=D(Object(j.extent)(t,t=>t[0]),L);return[[i[0],e[0]],[i[1],e[1]]]}(i);try{return T({},k({bounds:c,width:n,height:a,minExtent:o,maxZoom:s,offset:r,padding:l}),{bearing:h,pitch:u})}catch(t){console.error("Could not fit viewport",t)}return t}},4308:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n=i(12),a=i.n(n);const o=[1,0,1,0,0,0,0];function s(t,e){const i=parseInt(a()(e).format("x"),10);return parseInt(a()(e).add(t).format("x"),10)-i}function r(t,e){const i=a()(Math.min(...t)),n=a()(Math.max(...t));let r,l,h;if(e.includes("/")){const t=e.split("/",2);t[0].endsWith("Z")?(l=a()(t[0]),r=a.a.duration(t[1])):(l=a()(t[1]),r=a.a.duration(t[0]))}else r=a.a.duration(e),l=function(t,e){const i=a()(t).subtract(e),n=t.toArray(),s=i.toArray(),r=n.map((t,e)=>s[e]!==t).indexOf(!0),l=n.map((t,e)=>{if(e===r){const i=t-s[e];return t-(t-o[e])%i}return e<r||-1===r?t:o[e]});return a()(l)}(i,r);const u=i.valueOf();for(h=l.clone();h.valueOf()<u;)h.add(r);for(;h.valueOf()>u;)h.subtract(r);let c;const d=n.valueOf();for(c=l.clone();c.valueOf()>d;)c.subtract(r);for(;c.valueOf()<d;)c.add(r);const p=null!=e?[h,h.clone().add(r)]:[h,c],g=t.every(t=>null===t);return{start:parseInt(h.format("x"),10),end:parseInt(c.format("x"),10),getStep:s.bind(this,r),values:p.map(t=>parseInt(t.format("x"),10)),disabled:g}}},4309:function(t,e,i){"use strict";i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return r}));var n={SUM:1,MEAN:2,MIN:3,MAX:4};function a(t,e){return t+e}function o(t,e){return e>t?e:t}function s(t,e){return e<t?e:t}function r(t,e){switch(n[t.toUpperCase()]||n.SUM){case n.MIN:return function(t){return function(t,e){var i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(s,1/0):null}(t,e)};case n.SUM:return function(t){return function(t,e){var i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(a,0):null}(t,e)};case n.MEAN:return function(t){return function(t,e){var i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(a,0)/i.length:null}(t,e)};case n.MAX:return function(t){return function(t,e){var i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(o,-1/0):null}(t,e)};default:return null}}},4311:function(t,e,i){"use strict";i.d(e,"a",(function(){return y}));var n=i(0),a=i.n(n),o=i(5),s=i.n(o),r=i(4310),l=i(3518),h=i.n(l),u=i(18),c=i(4315),d=i.n(c);i(4317),i(4318);function p(t){return a.a.createElement("span",{className:"BootstrapSliderWrapper"},a.a.createElement(d.a,t))}i(4319);const g={start:s.a.number.isRequired,step:s.a.number.isRequired,end:s.a.number.isRequired,values:s.a.array.isRequired,onChange:s.a.func,loopDuration:s.a.number,maxFrames:s.a.number,orientation:s.a.oneOf(["horizontal","vertical"]),reversed:s.a.bool,disabled:s.a.bool,range:s.a.bool};class f extends a.a.PureComponent{constructor(t){super(t),this.state={intervalId:null};const e=t.end-t.start,i=Math.min(t.maxFrames,e/t.step),n=e/i;this.intervalMilliseconds=t.loopDuration/i,this.increment=n<t.step?t.step:n-n%t.step,this.onChange=this.onChange.bind(this),this.play=this.play.bind(this),this.pause=this.pause.bind(this),this.stepBackward=this.stepBackward.bind(this),this.stepForward=this.stepForward.bind(this),this.getPlayClass=this.getPlayClass.bind(this),this.formatter=this.formatter.bind(this)}componentDidMount(){h.a.bind(["space"],this.play)}componentWillUnmount(){h.a.unbind(["space"])}onChange(t){this.props.onChange(t.target.value),null!=this.state.intervalId&&this.pause()}getPlayClass(){return null==this.state.intervalId?"fa fa-play fa-lg slider-button":"fa fa-pause fa-lg slider-button"}play(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{const t=setInterval(this.stepForward,this.intervalMilliseconds);this.setState({intervalId:t})}}pause(){clearInterval(this.state.intervalId),this.setState({intervalId:null})}stepForward(){const{start:t,end:e,step:i,values:n,disabled:a}=this.props;if(a)return;const o=(Array.isArray(n)?n:[n,n+i]).map(t=>t+this.increment),s=o[1]>e?o[0]-t:0;this.props.onChange(o.map(t=>t-s))}stepBackward(){const{start:t,end:e,step:i,values:n,disabled:a}=this.props;if(a)return;const o=(Array.isArray(n)?n:[n,n+i]).map(t=>t-this.increment),s=o[0]<t?e-o[1]:0;this.props.onChange(o.map(t=>t+s))}formatter(t){if(this.props.disabled)return Object(u.e)("Data has no time steps");let e=t;return Array.isArray(t)?t[0]===t[1]&&(e=[t[0]]):e=[t],e.map(t=>new Date(t).toUTCString()).join(" : ")}render(){const{start:t,end:e,step:i,orientation:n,reversed:o,disabled:s,range:r,values:l}=this.props;return a.a.createElement("div",{className:"play-slider"},a.a.createElement("div",{className:"play-slider-controls padded"},a.a.createElement("i",{className:"fa fa-step-backward fa-lg slider-button ",onClick:this.stepBackward}),a.a.createElement("i",{className:this.getPlayClass(),onClick:this.play}),a.a.createElement("i",{className:"fa fa-step-forward fa-lg slider-button ",onClick:this.stepForward})),a.a.createElement("div",{className:"play-slider-scrobbler padded"},a.a.createElement(p,{value:r?l:l[0],range:r,formatter:this.formatter,change:this.onChange,min:t,max:e,step:i,orientation:n,reversed:o,disabled:s?"disabled":"enabled"})))}}function v(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}f.propTypes=g,f.defaultProps={onChange:()=>{},loopDuration:15e3,maxFrames:100,orientation:"horizontal",reversed:!1,disabled:!1,range:!0};const m={getLayers:s.a.func.isRequired,start:s.a.number.isRequired,end:s.a.number.isRequired,getStep:s.a.func,values:s.a.array.isRequired,aggregation:s.a.bool,disabled:s.a.bool,viewport:s.a.object.isRequired,children:s.a.node,mapStyle:s.a.string,mapboxApiAccessToken:s.a.string.isRequired,setControlValue:s.a.func,onValuesChange:s.a.func,width:s.a.number.isRequired,height:s.a.number.isRequired};class y extends a.a.PureComponent{constructor(){super(...arguments),v(this,"containerRef",a.a.createRef()),v(this,"setTooltip",t=>{const{current:e}=this.containerRef;e&&e.setTooltip(t)})}render(){const{start:t,end:e,getStep:i,disabled:n,aggregation:o,children:s,getLayers:l,values:h,onValuesChange:u,viewport:c,setControlValue:d,mapStyle:p,mapboxApiAccessToken:g,height:v,width:m}=this.props,y=l(h);return a.a.createElement("div",null,a.a.createElement(r.a,{ref:this.containerRef,viewport:c,layers:y,setControlValue:d,mapStyle:p,mapboxApiAccessToken:g,bottomMargin:n?0:20,width:m,height:v}),!n&&a.a.createElement(f,{start:t,end:e,step:i(t),values:h,range:!o,onChange:u}),s)}}y.propTypes=m,y.defaultProps={aggregation:!1,disabled:!1,mapStyle:"light",setControlValue:()=>{},onValuesChange:()=>{}}},4315:function(t,e,i){var n,a,o;a=[e,i(132),i(336),i(433),i(416),i(417),i(0),i(5),i(4316)],void 0===(o="function"==typeof(n=function(t,e,i,n,a,o,s,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReactBootstrapSlider=void 0;var h=m(e),u=m(i),c=m(n),d=m(a),p=m(o),g=m(s),f=m(r),v=m(l);function m(t){return t&&t.__esModule?t:{default:t}}var y=t.ReactBootstrapSlider=function(t){function e(){var t,i,n,a;(0,u.default)(this,e);for(var o=arguments.length,s=Array(o),r=0;r<o;r++)s[r]=arguments[r];return i=n=(0,d.default)(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(s))),n.checkAndDoDisabled=function(){var t="disabled"!==n.props.disabled,e=n.mySlider.isEnabled();t?e||n.mySlider.enable():e&&n.mySlider.disable()},n.updateSliderValues=function(){void 0===n.props.min||void 0===n.mySlider.min&&void 0===n.mySlider.options.min||n.mySlider.setAttribute("min",n.props.min),void 0===n.props.max||void 0===n.mySlider.max&&void 0===n.mySlider.options.max||n.mySlider.setAttribute("max",n.props.max),void 0===n.props.step||void 0===n.mySlider.step&&void 0===n.mySlider.options.step||n.mySlider.setAttribute("step",n.props.step),n.mySlider.setValue(n.props.value),n.checkAndDoDisabled()},a=i,(0,d.default)(n,a)}return(0,p.default)(e,t),(0,c.default)(e,[{key:"componentDidMount",value:function(){var t=this,e=(0,h.default)({},this.props,{tooltip:this.props.tooltip||"show"});if(this.mySlider=new v.default(this.node,e),this.props.change||this.props.handleChange){var i=this.props.change||this.props.handleChange;this.mySlider.on("change",(function(t){var e={target:{}};e.target.value=t.newValue,i(e)}))}this.props.slideStop&&this.mySlider.on("slideStop",(function(e){var i={target:{}};i.target.value=e,t.props.slideStop(i)})),this.checkAndDoDisabled()}},{key:"componentDidUpdate",value:function(){this.updateSliderValues()}},{key:"componentWillUnmount",value:function(){this.mySlider.destroy()}},{key:"render",value:function(){var t=this;return g.default.createElement("div",{ref:function(e){return t.node=e}})}}]),e}(g.default.Component);y.propTypes={min:f.default.number,max:f.default.number,step:f.default.number,value:f.default.oneOfType([f.default.number,f.default.arrayOf(f.default.number.isRequired).isRequired]).isRequired,disabled:f.default.string,tooltip:f.default.string,change:f.default.func,handleChange:f.default.func,slideStop:f.default.func,labelledby:f.default.oneOfType([f.default.string,f.default.arrayOf(f.default.string)])},t.default=y})?n.apply(e,a):n)||(t.exports=o)},4316:function(t,e,i){"use strict";var n,a,o,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r="object"===("undefined"==typeof window?"undefined":s(window));a=[i(138)],void 0===(o="function"==typeof(n=function(t){var e;return r&&!window.console&&(window.console={}),r&&!window.console.log&&(window.console.log=function(){}),r&&!window.console.warn&&(window.console.warn=function(){}),function(t){var e=Array.prototype.slice;function i(){}!function(t){if(t){var n="undefined"==typeof console?i:function(t){console.error(t)};t.bridget=function(i,a){!function(e){e.prototype.option||(e.prototype.option=function(e){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e))})}(a),function(i,a){t.fn[i]=function(o){if("string"==typeof o){for(var s=e.call(arguments,1),r=0,l=this.length;r<l;r++){var h=this[r],u=t.data(h,i);if(u)if(t.isFunction(u[o])&&"_"!==o.charAt(0)){var c=u[o].apply(u,s);if(void 0!==c&&c!==u)return c}else n("no such method '"+o+"' for "+i+" instance");else n("cannot call methods on "+i+" prior to initialization; attempted to call '"+o+"'")}return this}var d=this.map((function(){var e=t.data(this,i);return e?(e.option(o),e._init()):(e=new a(this,o),t.data(this,i,e)),t(this)}));return!d||d.length>1?d:d[0]}}(i,a)},t.bridget}}(t)}(t),function(t){var i=function(t){return"Invalid input value '"+t+"' passed in"},n={linear:{toValue:function(t){var e=t/100*(this.options.max-this.options.min),i=!0;if(this.options.ticks_positions.length>0){for(var n,a,o,s=0,r=1;r<this.options.ticks_positions.length;r++)if(t<=this.options.ticks_positions[r]){n=this.options.ticks[r-1],o=this.options.ticks_positions[r-1],a=this.options.ticks[r],s=this.options.ticks_positions[r];break}e=n+(t-o)/(s-o)*(a-n),i=!1}var l=(i?this.options.min:0)+Math.round(e/this.options.step)*this.options.step;return l<this.options.min?this.options.min:l>this.options.max?this.options.max:l},toPercentage:function(t){if(this.options.max===this.options.min)return 0;if(this.options.ticks_positions.length>0){for(var e,i,n,a=0,o=0;o<this.options.ticks.length;o++)if(t<=this.options.ticks[o]){e=o>0?this.options.ticks[o-1]:0,n=o>0?this.options.ticks_positions[o-1]:0,i=this.options.ticks[o],a=this.options.ticks_positions[o];break}if(o>0)return n+(t-e)/(i-e)*(a-n)}return 100*(t-this.options.min)/(this.options.max-this.options.min)}},logarithmic:{toValue:function(t){var e=0===this.options.min?0:Math.log(this.options.min),i=Math.log(this.options.max),n=Math.exp(e+(i-e)*t/100);return Math.round(n)===this.options.max?this.options.max:(n=this.options.min+Math.round((n-this.options.min)/this.options.step)*this.options.step)<this.options.min?this.options.min:n>this.options.max?this.options.max:n},toPercentage:function(t){if(this.options.max===this.options.min)return 0;var e=Math.log(this.options.max),i=0===this.options.min?0:Math.log(this.options.min);return 100*((0===t?0:Math.log(t))-i)/(e-i)}}};function a(e,i){this._state={value:null,enabled:null,offset:null,size:null,percentage:null,inDrag:!1,over:!1},this.ticksCallbackMap={},this.handleCallbackMap={},"string"==typeof e?this.element=document.querySelector(e):e instanceof HTMLElement&&(this.element=e),i=i||{};for(var a=Object.keys(this.defaultOptions),o=0;o<a.length;o++){var s=a[o],r=i[s];r=null!==(r=void 0!==r?r:l(this.element,s))?r:this.defaultOptions[s],this.options||(this.options={}),this.options[s]=r}function l(t,e){var i="data-slider-"+e.replace(/_/g,"-"),n=t.getAttribute(i);try{return JSON.parse(n)}catch(t){return n}}"auto"===this.options.rtl&&(this.options.rtl="rtl"===window.getComputedStyle(this.element).direction),"vertical"!==this.options.orientation||"top"!==this.options.tooltip_position&&"bottom"!==this.options.tooltip_position?"horizontal"!==this.options.orientation||"left"!==this.options.tooltip_position&&"right"!==this.options.tooltip_position||(this.options.tooltip_position="top"):this.options.rtl?this.options.tooltip_position="left":this.options.tooltip_position="right";var h,u,c,d,p,g=this.element.style.width,f=!1,v=this.element.parentNode;if(this.sliderElem)f=!0;else{this.sliderElem=document.createElement("div"),this.sliderElem.className="slider";var m=document.createElement("div");m.className="slider-track",(u=document.createElement("div")).className="slider-track-low",(h=document.createElement("div")).className="slider-selection",(c=document.createElement("div")).className="slider-track-high",(d=document.createElement("div")).className="slider-handle min-slider-handle",d.setAttribute("role","slider"),d.setAttribute("aria-valuemin",this.options.min),d.setAttribute("aria-valuemax",this.options.max),(p=document.createElement("div")).className="slider-handle max-slider-handle",p.setAttribute("role","slider"),p.setAttribute("aria-valuemin",this.options.min),p.setAttribute("aria-valuemax",this.options.max),m.appendChild(u),m.appendChild(h),m.appendChild(c),this.rangeHighlightElements=[];var y=this.options.rangeHighlights;if(Array.isArray(y)&&y.length>0)for(var b=0;b<y.length;b++){var _=document.createElement("div"),x=y[b].class||"";_.className="slider-rangeHighlight slider-selection "+x,this.rangeHighlightElements.push(_),m.appendChild(_)}var w=Array.isArray(this.options.labelledby);if(w&&this.options.labelledby[0]&&d.setAttribute("aria-labelledby",this.options.labelledby[0]),w&&this.options.labelledby[1]&&p.setAttribute("aria-labelledby",this.options.labelledby[1]),!w&&this.options.labelledby&&(d.setAttribute("aria-labelledby",this.options.labelledby),p.setAttribute("aria-labelledby",this.options.labelledby)),this.ticks=[],Array.isArray(this.options.ticks)&&this.options.ticks.length>0){for(this.ticksContainer=document.createElement("div"),this.ticksContainer.className="slider-tick-container",o=0;o<this.options.ticks.length;o++){var C=document.createElement("div");if(C.className="slider-tick",this.options.ticks_tooltip){var M=this._addTickListener(),k=M.addMouseEnter(this,C,o),P=M.addMouseLeave(this,C);this.ticksCallbackMap[o]={mouseEnter:k,mouseLeave:P}}this.ticks.push(C),this.ticksContainer.appendChild(C)}h.className+=" tick-slider-selection"}if(this.tickLabels=[],Array.isArray(this.options.ticks_labels)&&this.options.ticks_labels.length>0)for(this.tickLabelContainer=document.createElement("div"),this.tickLabelContainer.className="slider-tick-label-container",o=0;o<this.options.ticks_labels.length;o++){var S=document.createElement("div"),E=0===this.options.ticks_positions.length,O=this.options.reversed&&E?this.options.ticks_labels.length-(o+1):o;S.className="slider-tick-label",S.innerHTML=this.options.ticks_labels[O],this.tickLabels.push(S),this.tickLabelContainer.appendChild(S)}var j=function(t){var e=document.createElement("div");e.className="tooltip-arrow";var i=document.createElement("div");i.className="tooltip-inner",t.appendChild(e),t.appendChild(i)},A=document.createElement("div");A.className="tooltip tooltip-main",A.setAttribute("role","presentation"),j(A);var L=document.createElement("div");L.className="tooltip tooltip-min",L.setAttribute("role","presentation"),j(L);var D=document.createElement("div");D.className="tooltip tooltip-max",D.setAttribute("role","presentation"),j(D),this.sliderElem.appendChild(m),this.sliderElem.appendChild(A),this.sliderElem.appendChild(L),this.sliderElem.appendChild(D),this.tickLabelContainer&&this.sliderElem.appendChild(this.tickLabelContainer),this.ticksContainer&&this.sliderElem.appendChild(this.ticksContainer),this.sliderElem.appendChild(d),this.sliderElem.appendChild(p),v.insertBefore(this.sliderElem,this.element),this.element.style.display="none"}if(t&&(this.$element=t(this.element),this.$sliderElem=t(this.sliderElem)),this.eventToCallbackMap={},this.sliderElem.id=this.options.id,this.touchCapable="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,this.touchX=0,this.touchY=0,this.tooltip=this.sliderElem.querySelector(".tooltip-main"),this.tooltipInner=this.tooltip.querySelector(".tooltip-inner"),this.tooltip_min=this.sliderElem.querySelector(".tooltip-min"),this.tooltipInner_min=this.tooltip_min.querySelector(".tooltip-inner"),this.tooltip_max=this.sliderElem.querySelector(".tooltip-max"),this.tooltipInner_max=this.tooltip_max.querySelector(".tooltip-inner"),n[this.options.scale]&&(this.options.scale=n[this.options.scale]),!0===f&&(this._removeClass(this.sliderElem,"slider-horizontal"),this._removeClass(this.sliderElem,"slider-vertical"),this._removeClass(this.sliderElem,"slider-rtl"),this._removeClass(this.tooltip,"hide"),this._removeClass(this.tooltip_min,"hide"),this._removeClass(this.tooltip_max,"hide"),["left","right","top","width","height"].forEach((function(t){this._removeProperty(this.trackLow,t),this._removeProperty(this.trackSelection,t),this._removeProperty(this.trackHigh,t)}),this),[this.handle1,this.handle2].forEach((function(t){this._removeProperty(t,"left"),this._removeProperty(t,"right"),this._removeProperty(t,"top")}),this),[this.tooltip,this.tooltip_min,this.tooltip_max].forEach((function(t){this._removeProperty(t,"left"),this._removeProperty(t,"right"),this._removeProperty(t,"top"),this._removeProperty(t,"margin-left"),this._removeProperty(t,"margin-right"),this._removeProperty(t,"margin-top"),this._removeClass(t,"right"),this._removeClass(t,"left"),this._removeClass(t,"top")}),this)),"vertical"===this.options.orientation?(this._addClass(this.sliderElem,"slider-vertical"),this.stylePos="top",this.mousePos="pageY",this.sizePos="offsetHeight"):(this._addClass(this.sliderElem,"slider-horizontal"),this.sliderElem.style.width=g,this.options.orientation="horizontal",this.options.rtl?this.stylePos="right":this.stylePos="left",this.mousePos="pageX",this.sizePos="offsetWidth"),this.options.rtl&&this._addClass(this.sliderElem,"slider-rtl"),this._setTooltipPosition(),Array.isArray(this.options.ticks)&&this.options.ticks.length>0&&(this.options.max=Math.max.apply(Math,this.options.ticks),this.options.min=Math.min.apply(Math,this.options.ticks)),Array.isArray(this.options.value)?(this.options.range=!0,this._state.value=this.options.value):this.options.range?this._state.value=[this.options.value,this.options.max]:this._state.value=this.options.value,this.trackLow=u||this.trackLow,this.trackSelection=h||this.trackSelection,this.trackHigh=c||this.trackHigh,"none"===this.options.selection?(this._addClass(this.trackLow,"hide"),this._addClass(this.trackSelection,"hide"),this._addClass(this.trackHigh,"hide")):"after"!==this.options.selection&&"before"!==this.options.selection||(this._removeClass(this.trackLow,"hide"),this._removeClass(this.trackSelection,"hide"),this._removeClass(this.trackHigh,"hide")),this.handle1=d||this.handle1,this.handle2=p||this.handle2,!0===f)for(this._removeClass(this.handle1,"round triangle"),this._removeClass(this.handle2,"round triangle hide"),o=0;o<this.ticks.length;o++)this._removeClass(this.ticks[o],"round triangle hide");if(-1!==["round","triangle","custom"].indexOf(this.options.handle))for(this._addClass(this.handle1,this.options.handle),this._addClass(this.handle2,this.options.handle),o=0;o<this.ticks.length;o++)this._addClass(this.ticks[o],this.options.handle);if(this._state.offset=this._offset(this.sliderElem),this._state.size=this.sliderElem[this.sizePos],this.setValue(this._state.value),this.handle1Keydown=this._keydown.bind(this,0),this.handle1.addEventListener("keydown",this.handle1Keydown,!1),this.handle2Keydown=this._keydown.bind(this,1),this.handle2.addEventListener("keydown",this.handle2Keydown,!1),this.mousedown=this._mousedown.bind(this),this.touchstart=this._touchstart.bind(this),this.touchmove=this._touchmove.bind(this),this.touchCapable){var T=!1;try{var F=Object.defineProperty({},"passive",{get:function(){T=!0}});window.addEventListener("test",null,F)}catch(t){}var z=!!T&&{passive:!0};this.sliderElem.addEventListener("touchstart",this.touchstart,z),this.sliderElem.addEventListener("touchmove",this.touchmove,z)}if(this.sliderElem.addEventListener("mousedown",this.mousedown,!1),this.resize=this._resize.bind(this),window.addEventListener("resize",this.resize,!1),"hide"===this.options.tooltip)this._addClass(this.tooltip,"hide"),this._addClass(this.tooltip_min,"hide"),this._addClass(this.tooltip_max,"hide");else if("always"===this.options.tooltip)this._showTooltip(),this._alwaysShowTooltip=!0;else{if(this.showTooltip=this._showTooltip.bind(this),this.hideTooltip=this._hideTooltip.bind(this),this.options.ticks_tooltip){var N=this._addTickListener(),R=N.addMouseEnter(this,this.handle1),V=N.addMouseLeave(this,this.handle1);this.handleCallbackMap.handle1={mouseEnter:R,mouseLeave:V},R=N.addMouseEnter(this,this.handle2),V=N.addMouseLeave(this,this.handle2),this.handleCallbackMap.handle2={mouseEnter:R,mouseLeave:V}}else this.sliderElem.addEventListener("mouseenter",this.showTooltip,!1),this.sliderElem.addEventListener("mouseleave",this.hideTooltip,!1);this.handle1.addEventListener("focus",this.showTooltip,!1),this.handle1.addEventListener("blur",this.hideTooltip,!1),this.handle2.addEventListener("focus",this.showTooltip,!1),this.handle2.addEventListener("blur",this.hideTooltip,!1)}this.options.enabled?this.enable():this.disable()}if((e=function(t,e){return a.call(this,t,e),this}).prototype={_init:function(){},constructor:e,defaultOptions:{id:"",min:0,max:10,step:1,precision:0,orientation:"horizontal",value:5,range:!1,selection:"before",tooltip:"show",tooltip_split:!1,handle:"round",reversed:!1,rtl:"auto",enabled:!0,formatter:function(t){return Array.isArray(t)?t[0]+" : "+t[1]:t},natural_arrow_keys:!1,ticks:[],ticks_positions:[],ticks_labels:[],ticks_snap_bounds:0,ticks_tooltip:!1,scale:"linear",focus:!1,tooltip_position:null,labelledby:null,rangeHighlights:[]},getElement:function(){return this.sliderElem},getValue:function(){return this.options.range?this._state.value:this._state.value[0]},setValue:function(t,e,i){t||(t=0);var n=this.getValue();this._state.value=this._validateInputValue(t);var a=this._applyPrecision.bind(this);this.options.range?(this._state.value[0]=a(this._state.value[0]),this._state.value[1]=a(this._state.value[1]),this._state.value[0]=Math.max(this.options.min,Math.min(this.options.max,this._state.value[0])),this._state.value[1]=Math.max(this.options.min,Math.min(this.options.max,this._state.value[1]))):(this._state.value=a(this._state.value),this._state.value=[Math.max(this.options.min,Math.min(this.options.max,this._state.value))],this._addClass(this.handle2,"hide"),"after"===this.options.selection?this._state.value[1]=this.options.max:this._state.value[1]=this.options.min),this.options.max>this.options.min?this._state.percentage=[this._toPercentage(this._state.value[0]),this._toPercentage(this._state.value[1]),100*this.options.step/(this.options.max-this.options.min)]:this._state.percentage=[0,0,100],this._layout();var o=this.options.range?this._state.value:this._state.value[0];return this._setDataVal(o),!0===e&&this._trigger("slide",o),n!==o&&!0===i&&this._trigger("change",{oldValue:n,newValue:o}),this},destroy:function(){this._removeSliderEventHandlers(),this.sliderElem.parentNode.removeChild(this.sliderElem),this.element.style.display="",this._cleanUpEventCallbacksMap(),this.element.removeAttribute("data"),t&&(this._unbindJQueryEventHandlers(),this.$element.removeData("slider"))},disable:function(){return this._state.enabled=!1,this.handle1.removeAttribute("tabindex"),this.handle2.removeAttribute("tabindex"),this._addClass(this.sliderElem,"slider-disabled"),this._trigger("slideDisabled"),this},enable:function(){return this._state.enabled=!0,this.handle1.setAttribute("tabindex",0),this.handle2.setAttribute("tabindex",0),this._removeClass(this.sliderElem,"slider-disabled"),this._trigger("slideEnabled"),this},toggle:function(){return this._state.enabled?this.disable():this.enable(),this},isEnabled:function(){return this._state.enabled},on:function(t,e){return this._bindNonQueryEventHandler(t,e),this},off:function(e,i){t?(this.$element.off(e,i),this.$sliderElem.off(e,i)):this._unbindNonQueryEventHandler(e,i)},getAttribute:function(t){return t?this.options[t]:this.options},setAttribute:function(t,e){return this.options[t]=e,this},refresh:function(){return this._removeSliderEventHandlers(),a.call(this,this.element,this.options),t&&t.data(this.element,"slider",this),this},relayout:function(){return this._resize(),this._layout(),this},_removeSliderEventHandlers:function(){if(this.handle1.removeEventListener("keydown",this.handle1Keydown,!1),this.handle2.removeEventListener("keydown",this.handle2Keydown,!1),this.options.ticks_tooltip){for(var t=this.ticksContainer.getElementsByClassName("slider-tick"),e=0;e<t.length;e++)t[e].removeEventListener("mouseenter",this.ticksCallbackMap[e].mouseEnter,!1),t[e].removeEventListener("mouseleave",this.ticksCallbackMap[e].mouseLeave,!1);this.handle1.removeEventListener("mouseenter",this.handleCallbackMap.handle1.mouseEnter,!1),this.handle2.removeEventListener("mouseenter",this.handleCallbackMap.handle2.mouseEnter,!1),this.handle1.removeEventListener("mouseleave",this.handleCallbackMap.handle1.mouseLeave,!1),this.handle2.removeEventListener("mouseleave",this.handleCallbackMap.handle2.mouseLeave,!1)}this.handleCallbackMap=null,this.ticksCallbackMap=null,this.showTooltip&&(this.handle1.removeEventListener("focus",this.showTooltip,!1),this.handle2.removeEventListener("focus",this.showTooltip,!1)),this.hideTooltip&&(this.handle1.removeEventListener("blur",this.hideTooltip,!1),this.handle2.removeEventListener("blur",this.hideTooltip,!1)),this.showTooltip&&this.sliderElem.removeEventListener("mouseenter",this.showTooltip,!1),this.hideTooltip&&this.sliderElem.removeEventListener("mouseleave",this.hideTooltip,!1),this.sliderElem.removeEventListener("touchstart",this.touchstart,!1),this.sliderElem.removeEventListener("touchmove",this.touchmove,!1),this.sliderElem.removeEventListener("mousedown",this.mousedown,!1),window.removeEventListener("resize",this.resize,!1)},_bindNonQueryEventHandler:function(t,e){void 0===this.eventToCallbackMap[t]&&(this.eventToCallbackMap[t]=[]),this.eventToCallbackMap[t].push(e)},_unbindNonQueryEventHandler:function(t,e){var i=this.eventToCallbackMap[t];if(void 0!==i)for(var n=0;n<i.length;n++)if(i[n]===e){i.splice(n,1);break}},_cleanUpEventCallbacksMap:function(){for(var t=Object.keys(this.eventToCallbackMap),e=0;e<t.length;e++){var i=t[e];delete this.eventToCallbackMap[i]}},_showTooltip:function(){!1===this.options.tooltip_split?(this._addClass(this.tooltip,"in"),this.tooltip_min.style.display="none",this.tooltip_max.style.display="none"):(this._addClass(this.tooltip_min,"in"),this._addClass(this.tooltip_max,"in"),this.tooltip.style.display="none"),this._state.over=!0},_hideTooltip:function(){!1===this._state.inDrag&&!0!==this.alwaysShowTooltip&&(this._removeClass(this.tooltip,"in"),this._removeClass(this.tooltip_min,"in"),this._removeClass(this.tooltip_max,"in")),this._state.over=!1},_setToolTipOnMouseOver:function(t){var e=this.options.formatter(t?t.value[0]:this._state.value[0]),i=n(t||this._state,this.options.reversed);function n(t,e){return e?[100-t.percentage[0],this.options.range?100-t.percentage[1]:t.percentage[1]]:[t.percentage[0],t.percentage[1]]}this._setText(this.tooltipInner,e),this.tooltip.style[this.stylePos]=i[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetWidth/2+"px")},_addTickListener:function(){return{addMouseEnter:function(t,e,i){var n=function(){var e=t._state,n=i>=0?i:this.attributes["aria-valuenow"].value,a=parseInt(n,10);e.value[0]=a,e.percentage[0]=t.options.ticks_positions[a],t._setToolTipOnMouseOver(e),t._showTooltip()};return e.addEventListener("mouseenter",n,!1),n},addMouseLeave:function(t,e){var i=function(){t._hideTooltip()};return e.addEventListener("mouseleave",i,!1),i}}},_layout:function(){var t,e;if(t=this.options.reversed?[100-this._state.percentage[0],this.options.range?100-this._state.percentage[1]:this._state.percentage[1]]:[this._state.percentage[0],this._state.percentage[1]],this.handle1.style[this.stylePos]=t[0]+"%",this.handle1.setAttribute("aria-valuenow",this._state.value[0]),isNaN(this.options.formatter(this._state.value[0]))&&this.handle1.setAttribute("aria-valuetext",this.options.formatter(this._state.value[0])),this.handle2.style[this.stylePos]=t[1]+"%",this.handle2.setAttribute("aria-valuenow",this._state.value[1]),isNaN(this.options.formatter(this._state.value[1]))&&this.handle2.setAttribute("aria-valuetext",this.options.formatter(this._state.value[1])),this.rangeHighlightElements.length>0&&Array.isArray(this.options.rangeHighlights)&&this.options.rangeHighlights.length>0)for(var i=0;i<this.options.rangeHighlights.length;i++){var n=this._toPercentage(this.options.rangeHighlights[i].start),a=this._toPercentage(this.options.rangeHighlights[i].end);if(this.options.reversed){var o=100-a;a=100-n,n=o}var s=this._createHighlightRange(n,a);s?"vertical"===this.options.orientation?(this.rangeHighlightElements[i].style.top=s.start+"%",this.rangeHighlightElements[i].style.height=s.size+"%"):(this.options.rtl?this.rangeHighlightElements[i].style.right=s.start+"%":this.rangeHighlightElements[i].style.left=s.start+"%",this.rangeHighlightElements[i].style.width=s.size+"%"):this.rangeHighlightElements[i].style.display="none"}if(Array.isArray(this.options.ticks)&&this.options.ticks.length>0){var r,l="vertical"===this.options.orientation?"height":"width";r="vertical"===this.options.orientation?"marginTop":this.options.rtl?"marginRight":"marginLeft";var h=this._state.size/(this.options.ticks.length-1);if(this.tickLabelContainer){var u=0;if(0===this.options.ticks_positions.length)"vertical"!==this.options.orientation&&(this.tickLabelContainer.style[r]=-h/2+"px"),u=this.tickLabelContainer.offsetHeight;else for(c=0;c<this.tickLabelContainer.childNodes.length;c++)this.tickLabelContainer.childNodes[c].offsetHeight>u&&(u=this.tickLabelContainer.childNodes[c].offsetHeight);"horizontal"===this.options.orientation&&(this.sliderElem.style.marginBottom=u+"px")}for(var c=0;c<this.options.ticks.length;c++){var d=this.options.ticks_positions[c]||this._toPercentage(this.options.ticks[c]);this.options.reversed&&(d=100-d),this.ticks[c].style[this.stylePos]=d+"%",this._removeClass(this.ticks[c],"in-selection"),this.options.range?d>=t[0]&&d<=t[1]&&this._addClass(this.ticks[c],"in-selection"):"after"===this.options.selection&&d>=t[0]?this._addClass(this.ticks[c],"in-selection"):"before"===this.options.selection&&d<=t[0]&&this._addClass(this.ticks[c],"in-selection"),this.tickLabels[c]&&(this.tickLabels[c].style[l]=h+"px","vertical"!==this.options.orientation&&void 0!==this.options.ticks_positions[c]?(this.tickLabels[c].style.position="absolute",this.tickLabels[c].style[this.stylePos]=d+"%",this.tickLabels[c].style[r]=-h/2+"px"):"vertical"===this.options.orientation&&(this.options.rtl?this.tickLabels[c].style.marginRight=this.sliderElem.offsetWidth+"px":this.tickLabels[c].style.marginLeft=this.sliderElem.offsetWidth+"px",this.tickLabelContainer.style[r]=this.sliderElem.offsetWidth/2*-1+"px"))}}if(this.options.range){e=this.options.formatter(this._state.value),this._setText(this.tooltipInner,e),this.tooltip.style[this.stylePos]=(t[1]+t[0])/2+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetWidth/2+"px");var p=this.options.formatter(this._state.value[0]);this._setText(this.tooltipInner_min,p);var g=this.options.formatter(this._state.value[1]);this._setText(this.tooltipInner_max,g),this.tooltip_min.style[this.stylePos]=t[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip_min,"margin-"+this.stylePos,-this.tooltip_min.offsetHeight/2+"px"):this._css(this.tooltip_min,"margin-"+this.stylePos,-this.tooltip_min.offsetWidth/2+"px"),this.tooltip_max.style[this.stylePos]=t[1]+"%","vertical"===this.options.orientation?this._css(this.tooltip_max,"margin-"+this.stylePos,-this.tooltip_max.offsetHeight/2+"px"):this._css(this.tooltip_max,"margin-"+this.stylePos,-this.tooltip_max.offsetWidth/2+"px")}else e=this.options.formatter(this._state.value[0]),this._setText(this.tooltipInner,e),this.tooltip.style[this.stylePos]=t[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetWidth/2+"px");if("vertical"===this.options.orientation)this.trackLow.style.top="0",this.trackLow.style.height=Math.min(t[0],t[1])+"%",this.trackSelection.style.top=Math.min(t[0],t[1])+"%",this.trackSelection.style.height=Math.abs(t[0]-t[1])+"%",this.trackHigh.style.bottom="0",this.trackHigh.style.height=100-Math.min(t[0],t[1])-Math.abs(t[0]-t[1])+"%";else{"right"===this.stylePos?this.trackLow.style.right="0":this.trackLow.style.left="0",this.trackLow.style.width=Math.min(t[0],t[1])+"%","right"===this.stylePos?this.trackSelection.style.right=Math.min(t[0],t[1])+"%":this.trackSelection.style.left=Math.min(t[0],t[1])+"%",this.trackSelection.style.width=Math.abs(t[0]-t[1])+"%","right"===this.stylePos?this.trackHigh.style.left="0":this.trackHigh.style.right="0",this.trackHigh.style.width=100-Math.min(t[0],t[1])-Math.abs(t[0]-t[1])+"%";var f=this.tooltip_min.getBoundingClientRect(),v=this.tooltip_max.getBoundingClientRect();"bottom"===this.options.tooltip_position?f.right>v.left?(this._removeClass(this.tooltip_max,"bottom"),this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top="",this.tooltip_max.style.bottom="22px"):(this._removeClass(this.tooltip_max,"top"),this._addClass(this.tooltip_max,"bottom"),this.tooltip_max.style.top=this.tooltip_min.style.top,this.tooltip_max.style.bottom=""):f.right>v.left?(this._removeClass(this.tooltip_max,"top"),this._addClass(this.tooltip_max,"bottom"),this.tooltip_max.style.top="18px"):(this._removeClass(this.tooltip_max,"bottom"),this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top=this.tooltip_min.style.top)}},_createHighlightRange:function(t,e){return this._isHighlightRange(t,e)?t>e?{start:e,size:t-e}:{start:t,size:e-t}:null},_isHighlightRange:function(t,e){return 0<=t&&t<=100&&0<=e&&e<=100},_resize:function(t){this._state.offset=this._offset(this.sliderElem),this._state.size=this.sliderElem[this.sizePos],this._layout()},_removeProperty:function(t,e){t.style.removeProperty?t.style.removeProperty(e):t.style.removeAttribute(e)},_mousedown:function(t){if(!this._state.enabled)return!1;this._state.offset=this._offset(this.sliderElem),this._state.size=this.sliderElem[this.sizePos];var e=this._getPercentage(t);if(this.options.range){var i=Math.abs(this._state.percentage[0]-e),n=Math.abs(this._state.percentage[1]-e);this._state.dragged=i<n?0:1,this._adjustPercentageForRangeSliders(e)}else this._state.dragged=0;this._state.percentage[this._state.dragged]=e,this._layout(),this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),this.mousemove&&document.removeEventListener("mousemove",this.mousemove,!1),this.mouseup&&document.removeEventListener("mouseup",this.mouseup,!1),this.mousemove=this._mousemove.bind(this),this.mouseup=this._mouseup.bind(this),this.touchCapable&&(document.addEventListener("touchmove",this.mousemove,!1),document.addEventListener("touchend",this.mouseup,!1)),document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("mouseup",this.mouseup,!1),this._state.inDrag=!0;var a=this._calculateValue();return this._trigger("slideStart",a),this._setDataVal(a),this.setValue(a,!1,!0),t.returnValue=!1,this.options.focus&&this._triggerFocusOnHandle(this._state.dragged),!0},_touchstart:function(t){if(void 0!==t.changedTouches){var e=t.changedTouches[0];this.touchX=e.pageX,this.touchY=e.pageY}else this._mousedown(t)},_triggerFocusOnHandle:function(t){0===t&&this.handle1.focus(),1===t&&this.handle2.focus()},_keydown:function(t,e){if(!this._state.enabled)return!1;var i;switch(e.keyCode){case 37:case 40:i=-1;break;case 39:case 38:i=1}if(i){if(this.options.natural_arrow_keys){var n="vertical"===this.options.orientation&&!this.options.reversed,a="horizontal"===this.options.orientation&&this.options.reversed;(n||a)&&(i=-i)}var o=this._state.value[t]+i*this.options.step,s=o/this.options.max*100;return this._state.keyCtrl=t,this.options.range&&(this._adjustPercentageForRangeSliders(s),o=[this._state.keyCtrl?this._state.value[0]:o,this._state.keyCtrl?o:this._state.value[1]]),this._trigger("slideStart",o),this._setDataVal(o),this.setValue(o,!0,!0),this._setDataVal(o),this._trigger("slideStop",o),this._layout(),this._pauseEvent(e),delete this._state.keyCtrl,!1}},_pauseEvent:function(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1},_mousemove:function(t){if(!this._state.enabled)return!1;var e=this._getPercentage(t);this._adjustPercentageForRangeSliders(e),this._state.percentage[this._state.dragged]=e,this._layout();var i=this._calculateValue(!0);return this.setValue(i,!0,!0),!1},_touchmove:function(t){if(void 0!==t.changedTouches){var e=t.changedTouches[0],i=e.pageX-this.touchX,n=e.pageY-this.touchY;this._state.inDrag||("vertical"===this.options.orientation&&i<=5&&i>=-5&&(n>=15||n<=-15)?this._mousedown(t):n<=5&&n>=-5&&(i>=15||i<=-15)&&this._mousedown(t))}},_adjustPercentageForRangeSliders:function(t){if(this.options.range){var e=this._getNumDigitsAfterDecimalPlace(t);e=e?e-1:0;var i=this._applyToFixedAndParseFloat(t,e);0===this._state.dragged&&this._applyToFixedAndParseFloat(this._state.percentage[1],e)<i?(this._state.percentage[0]=this._state.percentage[1],this._state.dragged=1):1===this._state.dragged&&this._applyToFixedAndParseFloat(this._state.percentage[0],e)>i?(this._state.percentage[1]=this._state.percentage[0],this._state.dragged=0):0===this._state.keyCtrl&&this._state.value[1]/this.options.max*100<t?(this._state.percentage[0]=this._state.percentage[1],this._state.keyCtrl=1,this.handle2.focus()):1===this._state.keyCtrl&&this._state.value[0]/this.options.max*100>t&&(this._state.percentage[1]=this._state.percentage[0],this._state.keyCtrl=0,this.handle1.focus())}},_mouseup:function(){if(!this._state.enabled)return!1;this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1),this._state.inDrag=!1,!1===this._state.over&&this._hideTooltip();var t=this._calculateValue(!0);return this._layout(),this._setDataVal(t),this._trigger("slideStop",t),!1},_calculateValue:function(t){var e;if(this.options.range?(e=[this.options.min,this.options.max],0!==this._state.percentage[0]&&(e[0]=this._toValue(this._state.percentage[0]),e[0]=this._applyPrecision(e[0])),100!==this._state.percentage[1]&&(e[1]=this._toValue(this._state.percentage[1]),e[1]=this._applyPrecision(e[1]))):(e=this._toValue(this._state.percentage[0]),e=parseFloat(e),e=this._applyPrecision(e)),t){for(var i=[e,1/0],n=0;n<this.options.ticks.length;n++){var a=Math.abs(this.options.ticks[n]-e);a<=i[1]&&(i=[this.options.ticks[n],a])}if(i[1]<=this.options.ticks_snap_bounds)return i[0]}return e},_applyPrecision:function(t){var e=this.options.precision||this._getNumDigitsAfterDecimalPlace(this.options.step);return this._applyToFixedAndParseFloat(t,e)},_getNumDigitsAfterDecimalPlace:function(t){var e=(""+t).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return e?Math.max(0,(e[1]?e[1].length:0)-(e[2]?+e[2]:0)):0},_applyToFixedAndParseFloat:function(t,e){var i=t.toFixed(e);return parseFloat(i)},_getPercentage:function(t){!this.touchCapable||"touchstart"!==t.type&&"touchmove"!==t.type||(t=t.touches[0]);var e=t[this.mousePos]-this._state.offset[this.stylePos];"right"===this.stylePos&&(e=-e);var i=e/this._state.size*100;return i=Math.round(i/this._state.percentage[2])*this._state.percentage[2],this.options.reversed&&(i=100-i),Math.max(0,Math.min(100,i))},_validateInputValue:function(t){if(isNaN(+t)){if(Array.isArray(t))return this._validateArray(t),t;throw new Error(i(t))}return+t},_validateArray:function(t){for(var e=0;e<t.length;e++){var n=t[e];if("number"!=typeof n)throw new Error(i(n))}},_setDataVal:function(t){this.element.setAttribute("data-value",t),this.element.setAttribute("value",t),this.element.value=t},_trigger:function(e,i){i=i||0===i?i:void 0;var n=this.eventToCallbackMap[e];if(n&&n.length)for(var a=0;a<n.length;a++)(0,n[a])(i);t&&this._triggerJQueryEvent(e,i)},_triggerJQueryEvent:function(t,e){var i={type:t,value:e};this.$element.trigger(i),this.$sliderElem.trigger(i)},_unbindJQueryEventHandlers:function(){this.$element.off(),this.$sliderElem.off()},_setText:function(t,e){void 0!==t.textContent?t.textContent=e:void 0!==t.innerText&&(t.innerText=e)},_removeClass:function(t,e){for(var i=e.split(" "),n=t.className,a=0;a<i.length;a++){var o=i[a],s=new RegExp("(?:\\s|^)"+o+"(?:\\s|$)");n=n.replace(s," ")}t.className=n.trim()},_addClass:function(t,e){for(var i=e.split(" "),n=t.className,a=0;a<i.length;a++){var o=i[a];new RegExp("(?:\\s|^)"+o+"(?:\\s|$)").test(n)||(n+=" "+o)}t.className=n.trim()},_offsetLeft:function(t){return t.getBoundingClientRect().left},_offsetRight:function(t){return t.getBoundingClientRect().right},_offsetTop:function(t){for(var e=t.offsetTop;(t=t.offsetParent)&&!isNaN(t.offsetTop);)e+=t.offsetTop,"BODY"!==t.tagName&&(e-=t.scrollTop);return e},_offset:function(t){return{left:this._offsetLeft(t),right:this._offsetRight(t),top:this._offsetTop(t)}},_css:function(e,i,n){if(t)t.style(e,i,n);else{var a=i.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(t,e){return e.toUpperCase()}));e.style[a]=n}},_toValue:function(t){return this.options.scale.toValue.apply(this,[t])},_toPercentage:function(t){return this.options.scale.toPercentage.apply(this,[t])},_setTooltipPosition:function(){var t=[this.tooltip,this.tooltip_min,this.tooltip_max];if("vertical"===this.options.orientation){var e,i="left"===(e=this.options.tooltip_position?this.options.tooltip_position:this.options.rtl?"left":"right")?"right":"left";t.forEach(function(t){this._addClass(t,e),t.style[i]="100%"}.bind(this))}else"bottom"===this.options.tooltip_position?t.forEach(function(t){this._addClass(t,"bottom"),t.style.top="22px"}.bind(this)):t.forEach(function(t){this._addClass(t,"top"),t.style.top=-this.tooltip.outerHeight-14+"px"}.bind(this))}},t&&t.fn){var o=void 0;t.fn.slider?(r&&window.console.warn("bootstrap-slider.js - WARNING: $.fn.slider namespace is already bound. Use the $.fn.bootstrapSlider namespace instead."),o="bootstrapSlider"):(t.bridget("slider",e),o="slider"),t.bridget("bootstrapSlider",e),t((function(){t("input[data-provide=slider]")[o]()}))}}(t),e})?n.apply(e,a):n)||(t.exports=o)},4317:function(t,e,i){},4318:function(t,e,i){},4319:function(t,e,i){},4321:function(t,e,i){"use strict";i.d(e,"b",(function(){return k})),i.d(e,"a",(function(){return P}));var n=i(0),a=i.n(n),o=i(5),s=i.n(o),r=i(218),l=i(4310),h=i(1442),u=i(4311),c=i(4324),d=i(4332),p=i(4308),g=i(4307),f=i(4296);function v(){return(v=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function m(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const{getScale:y}=h.b;const b={formData:s.a.object.isRequired,mapboxApiKey:s.a.string.isRequired,setControlValue:s.a.func.isRequired,viewport:s.a.object.isRequired,getLayer:s.a.func.isRequired,getPoints:s.a.func.isRequired,payload:s.a.object.isRequired,onAddFilter:s.a.func,width:s.a.number.isRequired,height:s.a.number.isRequired};class _ extends a.a.PureComponent{constructor(t){super(t),m(this,"containerRef",a.a.createRef()),m(this,"setTooltip",t=>{const{current:e}=this.containerRef;e&&e.setTooltip(t)}),this.state=this.getStateFromProps(t),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this),this.toggleCategory=this.toggleCategory.bind(this),this.showSingleCategory=this.showSingleCategory.bind(this)}UNSAFE_componentWillReceiveProps(t){t.payload.form_data!==this.state.formData&&this.setState(v({},this.getStateFromProps(t)))}onValuesChange(t){this.setState({values:Array.isArray(t)?t:[t,t+this.state.getStep(t)]})}getStateFromProps(t,e){const i=t.payload.data.features||[],n=i.map(t=>t.__timestamp),a=function(t,e){const i=t.color_picker||{r:0,g:0,b:0,a:1},n=[i.r,i.g,i.b,255*i.a],a=y(t.color_scheme),o={};return e.forEach(e=>{if(null!=e.cat_color&&!o.hasOwnProperty(e.cat_color)){let s;s=t.dimension?Object(d.hexToRGB)(a(e.cat_color),255*i.a):n,o[e.cat_color]={color:s,enabled:!0}}}),o}(t.formData,i);if(e&&t.payload.form_data===e.formData)return v({},e,{categories:a});const o=t.payload.form_data.time_grain_sqla||t.payload.form_data.granularity||"P1D",{start:s,end:r,getStep:l,values:h,disabled:u}=Object(p.a)(n,o),{width:c,height:g,formData:m}=t;let{viewport:b}=t;return m.autozoom&&(b=Object(f.a)(b,{width:c,height:g,points:t.getPoints(i)})),{start:s,end:r,getStep:l,values:h,disabled:u,viewport:b,selected:[],lastClick:0,formData:t.payload.form_data,categories:a}}getLayers(t){const{getLayer:e,payload:i,formData:n,onAddFilter:a}=this.props;let o=i.data.features?[...i.data.features]:[];if(o=this.addColor(o,n),n.js_data_mutator){o=Object(g.a)(n.js_data_mutator)(o)}o=t[0]===t[1]||t[1]===this.end?o.filter(e=>e.__timestamp>=t[0]&&e.__timestamp<=t[1]):o.filter(e=>e.__timestamp>=t[0]&&e.__timestamp<t[1]);const s=this.state.categories;return n.dimension&&(o=o.filter(t=>s[t.cat_color]&&s[t.cat_color].enabled)),[e(n,v({},i,{data:v({},i.data,{features:o})}),a,this.setTooltip)]}addColor(t,e){const i=e.color_picker||{r:0,g:0,b:0,a:1},n=y(e.color_scheme);return t.map(t=>{let a;return e.dimension?(a=Object(d.hexToRGB)(n(t.cat_color),255*i.a),v({},t,{color:a})):t})}toggleCategory(t){const e=this.state.categories[t],i=v({},this.state.categories,{[t]:v({},e,{enabled:!e.enabled})});Object.values(i).every(t=>!t.enabled)&&Object.values(i).forEach(t=>{t.enabled=!0}),this.setState({categories:i})}showSingleCategory(t){const e=v({},this.state.categories);Object.values(e).forEach(t=>{t.enabled=!1}),e[t].enabled=!0,this.setState({categories:e})}render(){return a.a.createElement("div",{style:{position:"relative"}},a.a.createElement(u.a,{ref:this.containerRef,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},a.a.createElement(c.a,{categories:this.state.categories,toggleCategory:this.toggleCategory,showSingleCategory:this.showSingleCategory,position:this.props.formData.legend_position,format:this.props.formData.legend_format})))}}function x(){return(x=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function w(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}_.propTypes=b;const C={formData:s.a.object.isRequired,payload:s.a.object.isRequired,setControlValue:s.a.func.isRequired,viewport:s.a.object.isRequired,onAddFilter:s.a.func,width:s.a.number.isRequired,height:s.a.number.isRequired},M={onAddFilter(){}};function k(t,e){class i extends a.a.PureComponent{constructor(t){super(t),w(this,"containerRef",a.a.createRef()),w(this,"setTooltip",t=>{const{current:e}=this.containerRef;e&&e.setTooltip(t)});const{width:i,height:n,formData:o}=t;let{viewport:s}=t;o.autozoom&&(s=Object(f.a)(s,{width:i,height:n,points:e(t.payload.data.features)})),this.state={viewport:s,layer:this.computeLayer(t)},this.onViewportChange=this.onViewportChange.bind(this)}UNSAFE_componentWillReceiveProps(t){const e=x({},t.formData,{viewport:null}),i=x({},this.props.formData,{viewport:null});Object(r.isEqual)(e,i)&&t.payload===this.props.payload||this.setState({layer:this.computeLayer(t)})}onViewportChange(t){this.setState({viewport:t})}computeLayer(e){const{formData:i,payload:n,onAddFilter:a}=e;return t(i,n,a,this.setTooltip)}render(){const{formData:t,payload:e,setControlValue:i,height:n,width:o}=this.props,{layer:s,viewport:r}=this.state;return a.a.createElement(l.a,{ref:this.containerRef,mapboxApiAccessToken:e.data.mapboxApiKey,viewport:r,layers:[s],mapStyle:t.mapbox_style,setControlValue:i,width:o,height:n,onViewportChange:this.onViewportChange})}}return i.propTypes=C,i.defaultProps=M,i}function P(t,e){function i(i){const{formData:n,payload:o,setControlValue:s,viewport:r,width:l,height:h}=i;return a.a.createElement(_,{formData:n,mapboxApiKey:o.data.mapboxApiKey,setControlValue:s,viewport:r,getLayer:t,payload:o,getPoints:e,width:l,height:h})}return i.propTypes=C,i.defaultProps=M,i}},4324:function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var n=i(0),a=i.n(n),o=i(5),s=i.n(o),r=i(440);i(4326);const l={categories:s.a.object,toggleCategory:s.a.func,showSingleCategory:s.a.func,format:s.a.string,position:s.a.oneOf([null,"tl","tr","bl","br"])};class h extends a.a.PureComponent{format(t){if(!this.props.format)return t;const e=parseFloat(t);return Object(r.b)(this.props.format,e)}formatCategoryLabel(t){if(!this.props.format)return t;if(t.includes(" - ")){const e=t.split(" - ");return this.format(e[0])+" - "+this.format(e[1])}return this.format(t)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const t=Object.entries(this.props.categories).map(t=>{let[e,i]=t;const n={color:"rgba("+i.color.join(", ")+")"},o=i.enabled?"":"";return a.a.createElement("li",{key:e},a.a.createElement("a",{href:"#",onClick:()=>this.props.toggleCategory(e),onDoubleClick:()=>this.props.showSingleCategory(e)},a.a.createElement("span",{style:n},o)," ",this.formatCategoryLabel(e)))}),e={position:"absolute",["t"===this.props.position.charAt(0)?"top":"bottom"]:"0px",["r"===this.props.position.charAt(1)?"right":"left"]:"10px"};return a.a.createElement("div",{className:"legend",style:e},a.a.createElement("ul",{className:"categories"},t))}}h.propTypes=l,h.defaultProps={categories:{},toggleCategory:()=>{},showSingleCategory:()=>{},format:null,position:"tr"}},4326:function(t,e,i){},4327:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"a",(function(){return a}));var n=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function a(t,e,i){var n=new e(4*t.length);return t.forEach((function(t,e){var a=4*e;n[a]=t[0],n[a+1]=t[1],n[a+2]=t[2],n[a+3]=Number.isFinite(t[3])?t[3]:i})),n}},4359:function(t,e,i){"use strict";i.d(e,"a",(function(){return V}));var n,a=i(10),o=i(13),s=i(22),r=i(24),l=i(5261),h=i(5210),u=i(5211),c=i(4760),d=i(4361),p=i(5191),g=i(4706),f=i(5253),v=i(5213),m=i(4299),y=i(4476),b=i(4309),_={dataChanged:!0,viewportChanged:!0,cellSizeChanged:!0},x={changeFlags:_,projectPoints:!1,useGPU:!0,fp64:!1,viewport:null,gridTransformMatrix:null,createBufferObjects:!0},w=[32775,32774],C=[32776,32774],M=[32776,32775],k=(n={},Object(a.a)(n,b.a.SUM,32774),Object(a.a)(n,b.a.MEAN,32774),Object(a.a)(n,b.a.MIN,w),Object(a.a)(n,b.a.MAX,C),n),P={size:1,operation:b.a.SUM,needMin:!1,needMax:!1,combineMaxMin:!1},S=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],E="#define SHADER_NAME gpu-aggregation-to-grid-vs\n\nattribute vec2 positions;\nattribute vec3 weights;\nuniform vec2 windowSize;\nuniform vec2 cellSize;\nuniform vec2 gridSize;\nuniform mat4 uProjectionMatrix;\nuniform bool projectPoints;\n\nvarying vec3 vWeights;\n\nvec2 project_to_pixel(vec4 pos) {\n  vec4 result =  uProjectionMatrix * pos;\n  return result.xy/result.w;\n}\n\nvoid main(void) {\n\n  vWeights = weights;\n\n  vec4 windowPos = vec4(positions, 0, 1.);\n  if (projectPoints) {\n    windowPos = project_position_to_clipspace(vec3(positions, 0), vec2(0, 0), vec3(0, 0, 0));\n  }\n\n  vec2 pos = project_to_pixel(windowPos);\n  pos = floor(pos / cellSize);\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\n  vec2 offset = 1.0 / gridSize;\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n}\n",O="#define SHADER_NAME gpu-aggregation-to-grid-vs-64\n\nattribute vec2 positions;\nattribute vec2 positions64xyLow;\nattribute vec3 weights;\nuniform vec2 windowSize;\nuniform vec2 cellSize;\nuniform vec2 gridSize;\nuniform vec2 uProjectionMatrixFP64[16];\nuniform bool projectPoints;\n\nvarying vec3 vWeights;\n\nvoid project_to_pixel(vec2 pos, vec2 pos64xyLow, out vec2 pixelXY64[2]) {\n\n  vec2 result64[4];\n  vec2 position64[4];\n  position64[0] = vec2(pos.x, pos64xyLow.x);\n  position64[1] = vec2(pos.y, pos64xyLow.y);\n  position64[2] = vec2(0., 0.);\n  position64[3] = vec2(1., 0.);\n  mat4_vec4_mul_fp64(uProjectionMatrixFP64, position64,\n  result64);\n\n  pixelXY64[0] = div_fp64(result64[0], result64[3]);\n  pixelXY64[1] = div_fp64(result64[1], result64[3]);\n}\n\nvoid main(void) {\n\n  vWeights = weights;\n\n  vec2 windowPos = positions;\n  vec2 windowPos64xyLow = positions64xyLow;\n  if (projectPoints) {\n    vec2 projectedXY[2];\n    project_position_fp64(windowPos, windowPos64xyLow, projectedXY);\n    windowPos.x = projectedXY[0].x;\n    windowPos.y = projectedXY[1].x;\n    windowPos64xyLow.x = projectedXY[0].y;\n    windowPos64xyLow.y = projectedXY[1].y;\n  }\n\n  vec2 pixelXY64[2];\n  project_to_pixel(windowPos, windowPos64xyLow, pixelXY64);\n  vec2 gridXY64[2];\n  gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));\n  gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));\n  float x = floor(gridXY64[0].x);\n  float y = floor(gridXY64[1].x);\n  vec2 pos = vec2(x, y);\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\n  vec2 offset = 1.0 / gridSize;\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n}\n",j="#define SHADER_NAME gpu-aggregation-to-grid-fs\n\nprecision highp float;\n\nvarying vec3 vWeights;\n\nvoid main(void) {\n  gl_FragColor = vec4(vWeights, 1.0);\n}\n",A=i(4554),L=i(4404);function D(t,e){var i,n=e.width,o=void 0===n?1:n,s=e.height,r=void 0===s?1:s;return new A.a(t,{data:null,format:34836,type:5126,border:0,mipmaps:!1,parameters:(i={},Object(a.a)(i,10240,9728),Object(a.a)(i,10241,9728),i),dataFormat:6408,width:o,height:r})}function T(t,e){var i=e.id,n=e.width,o=void 0===n?1:n,s=e.height,r=void 0===s?1:s,l=e.texture;return new L.a(t,{id:i,width:o,height:r,attachments:Object(a.a)({},36064,l)})}function F(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return!t||t.length<e?new Float32Array(e).fill(i):t}var z=l.a.fp64ifyMatrix4,N=["aggregationBuffer","maxMinBuffer","minBuffer","maxBuffer"],R={maxData:"maxBuffer",minData:"minBuffer",maxMinData:"maxMinBuffer"},V=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,t),this.id=i.id||"gpu-grid-aggregator",this.shaderCache=i.shaderCache||null,this.gl=e,this.state={weights:null,gridPositions:null,positionsBuffer:null,positions64xyLowBuffer:null,vertexCount:0,fp64:null,useGPU:null,numCol:0,numRow:0,windowSize:null,cellSize:null,weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},resources:{},results:{}},this._hasGPUSupport=Object(h.d)(e)&&Object(u.c)(this.gl,c.a.BLEND_EQUATION_MINMAX,c.a.COLOR_ATTACHMENT_RGBA32F,c.a.TEXTURE_FLOAT)}return Object(r.a)(t,null,[{key:"getAggregationData",value:function(t){var e=t.aggregationData,i=t.maxData,n=t.minData,a=t.maxMinData,o=4*t.pixelIndex,s={};return e&&(s.cellCount=e[o+3],s.cellWeight=e[o]),a?(s.maxCellWieght=a[0],s.minCellWeight=a[3]):(i&&(s.maxCellWieght=i[0],s.totalCount=i[3]),n&&(s.minCellWeight=n[0],s.totalCount=i[3])),s}},{key:"getCellData",value:function(t){for(var e=t.countsData,i=t.size,n=void 0===i?1:i,a=e.length/4,o=new Float32Array(a*n),s=new Uint32Array(a),r=0;r<a;r++){for(var l=0;l<n;l++)o[r*n+l]=e[4*r+l];s[r]=e[4*r+3]}return{cellCounts:s,cellWeights:o}}},{key:"isSupported",value:function(t){return Object(h.d)(t)&&Object(u.c)(t,c.a.BLEND_EQUATION_MINMAX,c.a.COLOR_ATTACHMENT_RGBA32F,c.a.TEXTURE_FLOAT)}}]),Object(r.a)(t,[{key:"delete",value:function(){var t=this.gridAggregationModel,e=this.allAggregationModel,i=this.meanTransform,n=this.state,a=n.positionsBuffer,o=n.positions64xyLowBuffer,s=n.textures,r=n.framebuffers,l=n.maxMinFramebuffers,h=n.minFramebuffers,u=n.maxFramebuffers,c=n.meanTextures,d=n.resources;t&&t.delete(),e&&e.delete(),i&&i.delete(),a&&a.delete(),o&&o.delete(),this.deleteResources([r,s,l,h,u,c,d])}},{key:"run",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setState({results:{}});var e=this.getAggregationParams(t);this.updateGridSize(e);var i=e.useGPU;return this._hasGPUSupport&&i?this.runAggregationOnGPU(e):(i&&m.a.info("GPUGridAggregator: GPU Aggregation not supported, falling back to CPU")(),this.runAggregationOnCPU(e))}},{key:"getData",value:function(t){var e={},i=this.state.results;for(var n in i[t].aggregationData||(i[t].aggregationData=i[t].aggregationBuffer.getData()),e.aggregationData=i[t].aggregationData,R){var a=R[n];(i[t][n]||i[t][a])&&(i[t][n]=i[t][n]||i[t][a].getData(),e[n]=i[t][n])}return e}},{key:"deleteResources",value:function(t){(t=Array.isArray(t)?t:[t]).forEach((function(t){for(var e in t)t[e].delete()}))}},{key:"getAggregationParams",value:function(t){var e=Object.assign({},x,t),i=e.useGPU,n=e.gridTransformMatrix,a=e.viewport,o=e.weights,s=e.projectPoints,r=e.cellSize;return this.state.useGPU!==i&&(e.changeFlags=Object.assign({},e.changeFlags,_)),!r||this.state.cellSize&&this.state.cellSize[0]===r[0]&&this.state.cellSize[1]===r[1]||(e.changeFlags.cellSizeChanged=!0,this.setState({cellSize:r})),this.validateProps(e,t),this.setState({useGPU:i}),e.gridTransformMatrix=(s?a.viewportMatrix:n)||S,o&&(e.weights=this.normalizeWeightParams(o),this.setState({weights:e.weights})),e}},{key:"normalizeWeightParams",value:function(t){var e={};for(var i in t)e[i]=Object.assign({},P,t[i]);return e}},{key:"setState",value:function(t){Object.assign(this.state,t)}},{key:"shouldTransformToGrid",value:function(t){var e=t.projectPoints,i=t.changeFlags;return!!(!this.state.gridPositions||i.dataChanged||e&&i.viewportChanged)}},{key:"updateGridSize",value:function(t){var e=t.viewport,i=t.cellSize,n=t.width||e.width,a=t.height||e.height,o=Math.ceil(n/i[0]),s=Math.ceil(a/i[1]);this.setState({numCol:o,numRow:s,windowSize:[n,a]})}},{key:"validateProps",value:function(t,e){var i=t.changeFlags,n=t.projectPoints,a=t.gridTransformMatrix;m.a.assert(i.dataChanged||i.viewportChanged||i.cellSizeChanged),m.a.assert(!i.dataChanged||e.positions&&e.weights&&(!e.projectPositions||e.viewport)&&e.cellSize),m.a.assert(!i.cellSizeChanged||e.cellSize),m.a.assert(!(i.viewportChanged&&n)||e.viewport),n&&a&&m.a.warn("projectPoints is true, gridTransformMatrix is ignored")()}},{key:"calculateAggregationData",value:function(t){var e=t.weights,i=t.results,n=t.cellIndex,a=t.posIndex;for(var o in e){for(var s=e[o],r=s.values,l=s.size,h=s.operation,u=i[o].aggregationData,c=0;c<l;c++){var d=n+c,p=r[3*a+c];if(0===u[n+3])u[d]=p;else switch(h){case b.a.SUM:case b.a.MEAN:u[d]+=p;break;case b.a.MIN:u[d]=Math.min(u[d],p);break;case b.a.MAX:u[d]=Math.max(u[d],p);break;default:m.a.assert(!1)}}u[n+3]++}}},{key:"calculateMeanMaxMinData",value:function(t){var e=t.validCellIndices,i=t.results,n=t.weights;e.forEach((function(t){for(var e in i){for(var a=n[e],o=a.size,s=a.needMin,r=a.needMax,l=a.operation,h=i[e],u=h.aggregationData,c=h.minData,d=h.maxData,p=h.maxMinData,g=s||r,f=l===b.a.MEAN,v=s&&r&&n[e].combineMaxMin,m=u[t+4-1],y=0;y<o&&(g||f);y++){var _=t+y,x=u[_];f&&(u[_]/=m,x=u[_]),v?p[y]=Math.max(p[y],x):(s&&(c[y]=Math.min(c[y],x)),r&&(d[y]=Math.max(d[y],x)))}v?p[3]=Math.min(p[3],u[t+0]):(s&&(c[3]+=m),r&&(d[3]+=m))}}))}},{key:"initCPUResults",value:function(t){var e=t.weights||this.state.weights,i=this.state,n=i.numCol,a=i.numRow,o={};for(var s in e){var r=e[s],l=r.aggregationData,h=r.minData,u=r.maxData,c=r.maxMinData,d=e[s],p=d.needMin,g=d.needMax,f=p&&g&&e[s].combineMaxMin;l=F(l,n*a*4),f?((c=F(c,4)).fill(-1/0,0,3),c[3]=1/0):(p&&((h=F(h,4,1/0))[3]=0),g&&((u=F(u,4,-1/0))[3]=0)),o[s]=Object.assign({},e[s],{aggregationData:l,minData:h,maxData:u,maxMinData:c})}return o}},{key:"runAggregationOnCPU",value:function(t){var e,i,n=t.positions,a=t.cellSize,s=t.gridTransformMatrix,r=t.viewport,l=t.projectPoints,h=t.weights,u=this.state,c=u.numCol,d=u.numRow,p=this.initCPUResults(t),g=this.shouldTransformToGrid(t),f=[0,0,0];m.a.assert(g||t.changeFlags.cellSizeChanged),g?(i=n.length/2,e=new Float64Array(n.length),this.setState({gridPositions:e})):(e=this.state.gridPositions,h=this.state.weights,i=e.length/2);for(var v=new Set,b=0;b<i;b++){var _=void 0,x=void 0;if(g){if(f[0]=n[2*b],f[1]=n[2*b+1],l){var w=r.project(f),C=Object(o.a)(w,2);_=C[0],x=C[1]}else{var M=Object(y.k)(f,s),k=Object(o.a)(M,2);_=k[0],x=k[1]}e[2*b]=_,e[2*b+1]=x}else _=e[2*b],x=e[2*b+1];var P=Math.floor(_/a[0]),S=Math.floor(x/a[1]);if(P>=0&&P<c&&S>=0&&S<d){var E=4*(P+S*c);v.add(E),this.calculateAggregationData({weights:h,results:p,cellIndex:E,posIndex:b})}}return this.calculateMeanMaxMinData({validCellIndices:v,results:p,weights:h}),this.updateAggregationBuffers(t,p),this.setState({results:p}),p}},{key:"updateCPUResultBuffer",value:function(t){var e=t.gl,i=t.bufferName,n=t.id,a=t.data,o=t.result,s=this.state.resources,r="cpu-result-".concat(n,"-").concat(i);o[i]=o[i]||s[r],o[i]?o[i].setData({data:a}):(s[r]=new d.a(e,a),o[i]=s[r])}},{key:"updateAggregationBuffers",value:function(t,e){if(t.createBufferObjects){var i=t.weights||this.state.weights;for(var n in e){var a=e[n],o=a.aggregationData,s=a.minData,r=a.maxData,l=a.maxMinData,h=i[n],u=h.needMin,c=h.needMax,d=u&&c&&i[n].combineMaxMin;this.updateCPUResultBuffer({gl:this.gl,bufferName:"aggregationBuffer",id:n,data:o,result:e[n]}),d?this.updateCPUResultBuffer({gl:this.gl,bufferName:"maxMinBuffer",id:n,data:l,result:e[n]}):(u&&this.updateCPUResultBuffer({gl:this.gl,bufferName:"minBuffer",id:n,data:s,result:e[n]}),c&&this.updateCPUResultBuffer({gl:this.gl,bufferName:"maxBuffer",id:n,data:r,result:e[n]}))}}}},{key:"getAggregateData",value:function(t){var e={},i=this.state,n=i.textures,a=i.framebuffers,o=i.maxMinFramebuffers,s=i.minFramebuffers,r=i.maxFramebuffers,l=i.weights;for(var h in l){e[h]={};var u=l[h],c=u.needMin,d=u.needMax,g=u.combineMaxMin;e[h].aggregationTexture=n[h],e[h].aggregationBuffer=Object(p.c)(a[h],{target:l[h].aggregationBuffer,sourceType:5126}),c&&d&&g?e[h].maxMinBuffer=Object(p.c)(o[h],{target:l[h].maxMinBuffer,sourceType:5126}):(c&&(e[h].minBuffer=Object(p.c)(s[h],{target:l[h].minBuffer,sourceType:5126})),d&&(e[h].maxBuffer=Object(p.c)(r[h],{target:l[h].maxBuffer,sourceType:5126})))}return this.trackGPUResultBuffers(e,l),e}},{key:"getAggregationModel",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.gl,i=this.shaderCache;return new g.a(e,{id:"Gird-Aggregation-Model",vs:t?O:E,fs:j,modules:t?["fp64","project64"]:["project32"],shaderCache:i,vertexCount:0,drawMode:0})}},{key:"getAllAggregationModel",value:function(){var t=this.gl,e=this.shaderCache,i=this.state,n=i.numCol,a=i.numRow;return new g.a(t,{id:"All-Aggregation-Model",vs:"#version 300 es\n#define SHADER_NAME gpu-aggregation-all-vs-64\n\nin vec2 position;\nuniform ivec2 gridSize;\nout vec2 vTextureCoord;\n\nvoid main(void) {\n  vec2 pos = vec2(-1.0, -1.0);\n  vec2 offset = 1.0 / vec2(gridSize);\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n\n  int yIndex = gl_InstanceID / gridSize[0];\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 yIndexFP64 = vec2(float(yIndex), 0.);\n  vec2 xIndexFP64 = vec2(float(xIndex), 0.);\n  vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);\n  vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);\n\n  vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);\n  vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);\n\n  vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-aggregation-all-fs\n\nprecision highp float;\n\nin vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform bool combineMaxMin;\nout vec4 fragColor;\nvoid main(void) {\n  vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n  if (textureColor.a == 0.) {\n    discard;\n  }\n  fragColor.rgb = textureColor.rgb;\n  fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;\n}\n",modules:["fp64"],shaderCache:e,vertexCount:1,drawMode:0,isInstanced:!0,instanceCount:n*a,attributes:{position:[0,0]}})}},{key:"getMeanTransform",value:function(t){return this.meanTransform?this.meanTransform.update(t):this.meanTransform=new f.a(this.gl,Object.assign({},{vs:"#define SHADER_NAME gpu-aggregation-transform-mean-vs\nattribute vec4 aggregationValues;\nvarying vec4 meanValues;\n\nvoid main()\n{\n  bool isCellValid = bool(aggregationValues.w > 0.);\n  meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);\n  meanValues.w = aggregationValues.w;\n}\n",_targetTextureVarying:"meanValues"},t)),this.meanTransform}},{key:"renderAggregateData",value:function(t){var e=t.cellSize,i=t.viewport,n=t.gridTransformMatrix,a=t.projectPoints,o=this.state,s=o.numCol,r=o.numRow,l=o.windowSize,h=o.maxMinFramebuffers,u=o.minFramebuffers,c=o.maxFramebuffers,d=o.weights,p=[s,r],g={blend:!0,depthTest:!1,blendFunc:[1,1]},f={viewport:i},v={windowSize:l,cellSize:e,gridSize:p,uProjectionMatrix:n,uProjectionMatrixFP64:z(n),projectPoints:a};for(var m in d){var y=d[m],b=y.needMin,_=y.needMax,x=b&&_&&d[m].combineMaxMin;this.renderToWeightsTexture({id:m,parameters:g,moduleSettings:f,uniforms:v,gridSize:p}),x?this.renderToMaxMinTexture({id:m,parameters:Object.assign({},g,{blendEquation:M}),gridSize:p,minOrMaxFb:h[m],clearParams:{clearColor:[0,0,0,3402823466e29]},combineMaxMin:x}):(b&&this.renderToMaxMinTexture({id:m,parameters:Object.assign({},g,{blendEquation:w}),gridSize:p,minOrMaxFb:u[m],clearParams:{clearColor:[3402823466e29,3402823466e29,3402823466e29,0]},combineMaxMin:x}),_&&this.renderToMaxMinTexture({id:m,parameters:Object.assign({},g,{blendEquation:C}),gridSize:p,minOrMaxFb:c[m],combineMaxMin:x}))}}},{key:"renderToMaxMinTexture",value:function(t){var e=t.id,i=t.parameters,n=t.gridSize,a=t.minOrMaxFb,o=t.combineMaxMin,s=t.clearParams,r=void 0===s?{}:s,l=this.state.framebuffers,h=this.gl,u=this.allAggregationModel;a.bind(),h.viewport(0,0,n[0],n[1]),Object(v.a)(h,r,(function(){h.clear(16384)})),u.draw({parameters:i,uniforms:{uSampler:l[e].texture,gridSize:n,combineMaxMin:o}}),a.unbind()}},{key:"renderToWeightsTexture",value:function(t){var e=t.id,i=t.parameters,n=t.moduleSettings,o=t.uniforms,s=t.gridSize,r=this.state,l=r.framebuffers,h=r.equations,u=r.weightAttributes,c=r.weights,d=this.gl,p=this.gridAggregationModel,g=c[e].operation;l[e].bind(),d.viewport(0,0,s[0],s[1]);var f=g===b.a.MIN?[3402823466e29,3402823466e29,3402823466e29,0]:[0,0,0,0];Object(v.a)(d,{clearColor:f},(function(){d.clear(16384)}));var m={weights:u[e]};if(p.draw({parameters:Object.assign({},i,{blendEquation:h[e]}),moduleSettings:n,uniforms:o,attributes:m}),l[e].unbind(),g===b.a.MEAN){var y=this.state,_=y.meanTextures,x=y.textures,w={_sourceTextures:{aggregationValues:_[e]},_targetTexture:x[e],elementCount:x[e].width*x[e].height};this.getMeanTransform(w).run({parameters:{blend:!1,depthTest:!1}}),l[e].attach(Object(a.a)({},36064,x[e]))}}},{key:"runAggregationOnGPU",value:function(t){this.updateModels(t),this.setupFramebuffers(t),this.renderAggregateData(t);var e=this.getAggregateData(t);return this.setState({results:e}),e}},{key:"setupFramebuffers",value:function(t){var e=this.state,i=e.numCol,n=e.numRow,o=e.textures,s=e.framebuffers,r=e.maxMinFramebuffers,l=e.minFramebuffers,h=e.maxFramebuffers,u=e.resources,c=e.meanTextures,d=e.equations,p=e.weights,g={width:i,height:n};for(var f in p){var v=p[f],m=v.needMin,y=v.needMax,_=v.combineMaxMin,x=v.operation;o[f]=p[f].aggregationTexture||o[f]||D(this.gl,{id:"".concat(f,"-texture"),width:i,height:n}),o[f].resize(g);var w=o[f];x===b.a.MEAN&&(c[f]=c[f]||D(this.gl,{id:"".concat(f,"-mean-texture"),width:i,height:n}),c[f].resize(g),w=c[f]),s[f]?s[f].attach(Object(a.a)({},36064,w)):s[f]=T(this.gl,{id:"".concat(f,"-fb"),width:i,height:n,texture:w}),s[f].resize(g),d[f]=k[x],(m||y)&&(m&&y&&_?r[f]||(u["".concat(f,"-maxMin")]=D(this.gl,{id:"".concat(f,"-maxMinTex")}),r[f]=T(this.gl,{id:"".concat(f,"-maxMinFb"),texture:u["".concat(f,"-maxMin")]})):(m&&(l[f]||(u["".concat(f,"-min")]=D(this.gl,{id:"".concat(f,"-minTex")}),l[f]=T(this.gl,{id:"".concat(f,"-minFb"),texture:u["".concat(f,"-min")]}))),y&&(h[f]||(u["".concat(f,"-max")]=D(this.gl,{id:"".concat(f,"-maxTex")}),h[f]=T(this.gl,{id:"".concat(f,"-maxFb"),texture:u["".concat(f,"-max")]})))))}}},{key:"setupModels",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.gridAggregationModel&&this.gridAggregationModel.delete(),this.gridAggregationModel=this.getAggregationModel(t),this.allAggregationModel||(this.allAggregationModel=this.getAllAggregationModel())}},{key:"setupWeightAttributes",value:function(t){var e=this.state,i=e.weightAttributes,n=e.vertexCount,a=e.weights,o=e.resources;for(var s in a){var r=a[s].values;if(Array.isArray(r)||r.constructor===Float32Array){m.a.assert(r.length/3===n);var l=Array.isArray(r)?new Float32Array(r):r;i[s]instanceof d.a?i[s].setData(l):(o["".concat(s,"-buffer")]=new d.a(this.gl,l),i[s]=o["".concat(s,"-buffer")])}else m.a.assert(r instanceof d.a),i[s]=r}}},{key:"trackGPUResultBuffers",value:function(t,e){var i=this.state.resources;for(var n in t)if(t[n])for(var a=0;a<N.length;a++){var o=N[a];if(t[n][o]&&e[n][o]!==t[n][o]){var s="gpu-result-".concat(n,"-").concat(o);i[s]&&i[s].delete(),i[s]=t[n][o]}}}},{key:"updateModels",value:function(t){var e=this.gl,i=t.positions,n=t.positions64xyLow,a=t.changeFlags,o=this.state,s=o.numCol,r=o.numRow,l={},h=!1;if(t.fp64!==this.state.fp64&&(this.setupModels(t.fp64),this.setState({fp64:t.fp64}),h=!0),a.dataChanged||!this.state.positionsBuffer){var u=this.state,c=u.positionsBuffer,p=u.positions64xyLowBuffer;c&&c.delete(),p&&p.delete();var g=i.length/2;c=new d.a(e,new Float32Array(i)),p=new d.a(e,{data:new Float32Array(n),accessor:{size:2}}),this.setState({positionsBuffer:c,positions64xyLowBuffer:p,vertexCount:g}),this.setupWeightAttributes(t),h=!0}if(h){var f=this.state,v=f.vertexCount,m=f.positionsBuffer,y=f.positions64xyLowBuffer;l.positions=m,t.fp64&&(l.positions64xyLow=y),this.gridAggregationModel.setVertexCount(v),this.gridAggregationModel.setAttributes(l)}(a.cellSizeChanged||a.viewportChanged)&&this.allAggregationModel.setInstanceCount(s*r)}}]),t}()},4382:function(t,e,i){"use strict";i.d(e,"a",(function(){return d}));var n=i(22),a=i(24),o=i(293),s=i(106),r=i(335),l=i(29),h=i(4360),u=i(4299),c=i(4344),d=function(t){function e(){return Object(n.a)(this,e),Object(o.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(l.a)(e,t),Object(a.a)(e,[{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(){}},{key:"setState",value:function(t){Object(r.a)(Object(s.a)(e.prototype),"setState",this).call(this,t),this.setLayerNeedsUpdate()}},{key:"getPickingInfo",value:function(t){return t.info}},{key:"renderLayers",value:function(){return null}},{key:"shouldRenderSubLayer",value:function(t,e){var i=this.props._subLayerProps;return e&&e.length||i&&i[t]}},{key:"getSubLayerClass",value:function(t,e){var i=this.props._subLayerProps;return i&&i[t]&&i[t].type||e}},{key:"getSubLayerProps",value:function(t){var e=this.props,i=e.opacity,n=e.pickable,a=e.visible,o=e.parameters,s=e.getPolygonOffset,r=e.highlightedObjectIndex,l=e.autoHighlight,h=e.highlightColor,u=e.coordinateSystem,c=e.coordinateOrigin,d=e.wrapLongitude,p=e.positionFormat,g=e.modelMatrix,f=e._subLayerProps,v={opacity:i,pickable:n,visible:a,parameters:o,getPolygonOffset:s,highlightedObjectIndex:r,autoHighlight:l,highlightColor:h,coordinateSystem:u,coordinateOrigin:c,wrapLongitude:d,positionFormat:p,modelMatrix:g};if(t){var m=f&&f[t.id],y=m&&m.updateTriggers;Object.assign(v,t,m,{id:"".concat(this.props.id,"-").concat(t.id),updateTriggers:Object.assign({all:this.props.updateTriggers.all},t.updateTriggers,y)})}return v}},{key:"_getAttributeManager",value:function(){return null}},{key:"_renderLayers",value:function(){var t=this.internalState.subLayers;t&&!this.needsUpdate()?u.a.log(3,"Composite layer reused subLayers ".concat(this),this.internalState.subLayers)():(t=this.renderLayers(),t=Object(c.b)(t,{filter:Boolean}),this.internalState.subLayers=t,u.a.log(2,"Composite layer rendered new subLayers ".concat(this),t)());var e=!0,i=!1,n=void 0;try{for(var a,o=t[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){a.value.parent=this}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"isComposite",get:function(){return!0}}]),e}(h.a);d.layerName="CompositeLayer"},4383:function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var n=i(10),a=i(13),o=i(22),s=i(24),r=function(t){return t.length},l=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r;Object(o.a)(this,t),this.sortedBins=this.getSortedBins(e,i),this.maxCount=this.getMaxCount(),this.binMap=this.getBinMap()}return Object(s.a)(t,[{key:"getSortedBins",value:function(t,e){return t.reduce((function(t,i,n){var a=e(i.points);return null!=a&&t.push({i:Number.isFinite(i.index)?i.index:n,value:a,counts:i.points.length}),t}),[]).sort((function(t,e){return t.value-e.value}))}},{key:"getValueRange",value:function(t){var e=Object(a.a)(t,2),i=e[0],n=e[1],o=this.sortedBins.length;if(!o)return[0,0];var s=Math.ceil(i/100*(o-1)),r=Math.floor(n/100*(o-1));return[this.sortedBins[s].value,this.sortedBins[r].value]}},{key:"getMaxCount",value:function(){var t=0;return this.sortedBins.forEach((function(e){return t=t>e.counts?t:e.counts})),t}},{key:"getBinMap",value:function(){return this.sortedBins.reduce((function(t,e){return Object.assign(t,Object(n.a)({},e.i,e))}),{})}}]),t}()},4384:function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"a",(function(){return o}));var n=i(4299);function a(t,e){return function(i){return function(t,e,i){var a=t[1]-t[0];if(a<=0)return n.a.warn("quantizeScale: invalid domain, returning range[0]")(),e[0];var o=a/e.length,s=Math.floor((i-t[0])/o);return e[Math.max(Math.min(s,e.length-1),0)]}(t,e,i)}}function o(t,e){return function(i){return(i-t[0])/(t[1]-t[0])*(e[1]-e[0])+e[0]}}},4464:function(t,e,i){"use strict";i.d(e,"a",(function(){return C}));var n=i(22),a=i(24),o=i(293),s=i(106),r=i(335),l=i(29),h=i(4432),u=i(4360),c=i(5261),d=i(4469),p=i(4706),g=i(557),f=i(4299),v=i(5212),m=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(n.a)(this,e);var i=t.id,a=void 0===i?Object(v.c)("column-geometry"):i,r=y(t),l=r.indices,h=r.attributes;return Object(o.a)(this,Object(s.a)(e).call(this,Object(g.a)({},t,{id:a,indices:l,attributes:h})))}return Object(l.a)(e,t),e}(i(4492).a);function y(t){var e=t.radius,i=t.height,n=void 0===i?1:i,a=t.nradial,o=void 0===a?10:a,s=t.vertices;f.a.assert(!s||s.length>=o);for(var r=o+1,l=3*r,h=2*Math.PI/o,u=new Uint16Array(3*o*2),c=new Float32Array(3*l),d=new Float32Array(3*l),p=0,g=0;g<r;g++)for(var v=g*h,m=s&&s[g%o],y=s&&s[(g+1)%o],b=Math.sin(v),_=Math.cos(v),x=0;x<2;x++)c[p+0]=m?m[0]:_*e,c[p+1]=m?m[1]:b*e,c[p+2]=(.5-x)*n,d[p+0]=m?y[0]-m[0]:_,d[p+1]=m?y[1]-m[1]:b,p+=3;for(var w=0;w<r;w++){var C=Math.floor(w/2)*Math.sign(w%2-.5),M=C*h,k=s&&s[(C+o)%o],P=Math.sin(M),S=Math.cos(M);c[p+0]=k?k[0]:S*e,c[p+1]=k?k[1]:P*e,c[p+2]=n/2,d[p+2]=1,p+=3}for(var E=0,O=0;O<o;O++)u[E++]=2*O+0,u[E++]=2*O+2,u[E++]=2*O+0,u[E++]=2*O+1,u[E++]=2*O+1,u[E++]=2*O+3;return{indices:u,attributes:{POSITION:{size:3,value:c},NORMAL:{size:3,value:d}}}}var b=c.a.fp64LowPart,_=new d.a,x=[0,0,0,255],w={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,fp64:!1,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:function(t){return t.position}},getFillColor:{type:"accessor",value:x},getLineColor:{type:"accessor",value:x},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:_,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},C=function(t){function e(){return Object(n.a)(this,e),Object(o.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(l.a)(e,t),Object(a.a)(e,[{key:"getShaders",value:function(){return{vs:"\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec2 instancePositions64xyLow;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute float instanceStrokeWidths;\n\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nvarying vec4 vColor;\n\nvoid main(void) {\n  \n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (isStroke) {\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    strokeOffsetRatio += sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec2 centroidPosition64xyLow = instancePositions64xyLow;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n\n  if (extruded && !isStroke) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.0;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.0;\n  }\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","gouraud-lighting","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceFillColors:{size:4,type:5121,transition:!0,accessor:"getFillColor",defaultValue:x},instanceLineColors:{size:4,type:5121,transition:!0,accessor:"getLineColor",defaultValue:x},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}},{key:"updateState",value:function(t){var i=t.props,n=t.oldProps,a=t.changeFlags;Object(r.a)(Object(s.a)(e.prototype),"updateState",this).call(this,{props:i,oldProps:n,changeFlags:a});var o=i.fp64!==n.fp64;if(o){var l=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(l)}),this.getAttributeManager().invalidateAll()}(o||i.diskResolution!==n.diskResolution||i.vertices!==n.vertices)&&this._updateGeometry(i)}},{key:"getGeometry",value:function(t,e){var i=new m({radius:1,height:2,vertices:e,nradial:t}),n=0;if(e)for(var a=0;a<t;a++){var o=e[a];n+=Math.sqrt(o[0]*o[0]+o[1]*o[1])/t}else n=1;return this.setState({edgeDistance:Math.cos(Math.PI/t)*n}),i}},{key:"_getModel",value:function(t){return new p.a(t,Object.assign({},this.getShaders(),{id:this.props.id,isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"_updateGeometry",value:function(t){var e=t.diskResolution,i=t.vertices,n=this.getGeometry(e,i);this.setState({fillVertexCount:n.attributes.POSITION.value.length/3,wireframeVertexCount:n.indices.value.length}),this.state.model.setProps({geometry:n})}},{key:"draw",value:function(t){var e=t.uniforms,i=this.context.viewport,n=this.props,a=n.lineWidthUnits,o=n.lineWidthScale,s=n.lineWidthMinPixels,r=n.lineWidthMaxPixels,l=n.elevationScale,h=n.extruded,u=n.filled,c=n.stroked,d=n.wireframe,p=n.offset,g=n.coverage,f=n.radius,v=n.angle,m=this.state,y=m.model,b=m.fillVertexCount,_=m.wireframeVertexCount,x=m.edgeDistance,w="pixels"===a?i.distanceScales.metersPerPixel[2]:1;y.setUniforms(Object.assign({},e,{radius:f,angle:v/180*Math.PI,offset:p,extruded:h,coverage:g,elevationScale:l,edgeDistance:x,widthScale:o*w,widthMinPixels:s,widthMaxPixels:r})),h&&d&&(y.setProps({isIndexed:!0}),y.setVertexCount(_).setDrawMode(1).setUniforms({isStroke:!0}).draw()),u&&(y.setProps({isIndexed:!1}),y.setVertexCount(b).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!h&&c&&(y.setProps({isIndexed:!1}),y.setVertexCount(2*b/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}},{key:"calculateInstancePositions64xyLow",value:function(t,e){var i=e.startRow,n=e.endRow,a=this.use64bitPositions();if(t.constant=!a,a){var o=this.props,s=o.data,r=o.getPosition,l=t.value,u=i*t.size,c=Object(h.a)(s,i,n),d=c.iterable,p=c.objectInfo,g=!0,f=!1,v=void 0;try{for(var m,y=d[Symbol.iterator]();!(g=(m=y.next()).done);g=!0){var _=m.value;p.index++;var x=r(_,p);l[u++]=b(x[0]),l[u++]=b(x[1])}}catch(t){f=!0,v=t}finally{try{g||null==y.return||y.return()}finally{if(f)throw v}}}else t.value=new Float32Array(2)}}]),e}(u.a);C.layerName="ColumnLayer",C.defaultProps=w},4469:function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var n=i(22),a=i(293),o=i(106),s=i(21),r=i(29),l={ambient:.35,diffuse:.6,shininess:32,specularColor:[30,30,30]},h=function(t){function e(t){var i;return Object(n.a)(this,e),i=Object(a.a)(this,Object(o.a)(e).call(this,t)),t=Object.assign({},l,t),Object.assign(Object(s.a)(i),t),i}return Object(r.a)(e,t),e}((function t(){Object(n.a)(this,t)}))},4708:function(t,e,i){"use strict";i.r(e),i.d(e,"getLayer",(function(){return dt}));var n=i(22),a=i(24),o=i(293),s=i(106),r=i(29),l=i(4382),h=i(4359),u=i(335),c=i(4469),d=i(4299),p=i(4309),g=i(5260),f=i(5261),v=i(4283),m=i(4380),y=i(4432),b=v.a.count,_=f.a.fp64LowPart;function x(t){return Number.isFinite(t)?t:0}function w(t){var e=t.data,i=t.getPosition,n=t.cellSizeMeters,a=t.gpuGridAggregator,o=t.gpuAggregation,s=t.aggregationFlags,r=t.weightParams,l=t.fp64,h=void 0!==l&&l,u=t.coordinateSystem,c=void 0===u?m.a.LNGLAT:u,p=t.viewport,f=void 0===p?null:p,v=t.boundingBox,w=void 0===v?null:v,M={};s.dataChanged&&(w=(M=function(t,e,i){var n,a,o=b(t),s=new Float64Array(2*o),r=new Float32Array(2*o),l=1/0,h=-1/0,u=1/0,c=-1/0,d={};for(var p in i)d[p]=Object.assign({},i[p],{values:new Float32Array(3*o)});var g=Object(y.a)(t),f=g.iterable,v=g.objectInfo,m=!0,w=!1,C=void 0;try{for(var M,k=f[Symbol.iterator]();!(m=(M=k.next()).done);m=!0){var P=M.value;v.index++;var S=e(P,v),E=v.index;for(var O in a=S[0],n=S[1],s[2*E]=a,s[2*E+1]=n,r[2*E]=_(a),r[2*E+1]=_(n),i){var j=i[O].getWeight(P);Array.isArray(j)?(d[O].values[3*E]=j[0],d[O].values[3*E+1]=j[1],d[O].values[3*E+2]=j[2]):d[O].values[3*E]=j}Number.isFinite(n)&&Number.isFinite(a)&&(l=n<l?n:l,h=n>h?n:h,u=a<u?a:u,c=a>c?a:c)}}catch(t){w=!0,C=t}finally{try{m||null==k.return||k.return()}finally{if(w)throw C}}var A={xMin:x(u),xMax:x(c),yMin:x(l),yMax:x(h)};return{positions:s,positions64xyLow:r,weights:d,boundingBox:A}}(e,i,r)).boundingBox);var k=[n,n],P=[0,0];switch(d.a.assert(c===m.a.LNGLAT||c===m.a.IDENTITY),c){case m.a.LNGLAT:case m.a.LNGLAT_DEPRECATED:var S=function(t,e){var i=t.yMin,n=t.yMax;return function(t,e){var i=(s=t,s/6378e3*(180/Math.PI)),n=(a=e,o=t,o/6378e3*(180/Math.PI)/Math.cos(a*Math.PI/180));var a,o;var s;return{yOffset:i,xOffset:n}}(e,(i+n)/2)}(w,n);k=[S.xOffset,S.yOffset],P=[-180,-90];break;case m.a.IDENTITY:P=[-f.width/2,-f.height/2];break;default:d.a.assert(!1)}var E=function(t){var e=t.boundingBox,i=t.cellSize,n=t.worldOrigin,a=e.yMin,o=e.yMax,s=e.xMin,r=e.xMax,l=C(s-n[0],i[0])+n[0],h=C(a-n[1],i[1])+n[1],u=(new g.a).translate([-1*l,-1*h,0]),c=[l,h],d=r-s+i[0],p=o-a+i[1],f=[Math.ceil(d/i[0]),Math.ceil(p/i[1])];return{gridOrigin:c,gridSize:f,width:d,height:p,gridTransformMatrix:u}}({boundingBox:w,cellSize:k,worldOrigin:P});return{weights:a.run({positions:M.positions,positions64xyLow:M.positions64xyLow,weights:M.weights,cellSize:k,width:E.width,height:E.height,gridTransformMatrix:E.gridTransformMatrix,useGPU:o,changeFlags:s,fp64:h}),gridSize:E.gridSize,gridOrigin:E.gridOrigin,cellSize:k,boundingBox:w}}function C(t,e){var i=t<0?-1:1,n=i<0?Math.abs(t)+e:Math.abs(t);return(n=Math.floor(n/e)*e)*i}var M=i(4327),k=i(4360),P=i(4706),S=i(557),E=i(4492),O=i(5212),j=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),A=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),L=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),D=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),T={POSITION:{size:3,value:new Float32Array(A)},NORMAL:{size:3,value:new Float32Array(L)},TEXCOORD_0:{size:2,value:new Float32Array(D)}},F=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(n.a)(this,e);var i=t.id,a=void 0===i?Object(O.c)("cube-geometry"):i;return Object(o.a)(this,Object(s.a)(e).call(this,Object(S.a)({},t,{id:a,indices:{size:1,value:new Uint16Array(j)},attributes:Object(S.a)({},T,t.attributes)})))}return Object(r.a)(e,t),e}(E.a),z=f.a.fp64LowPart,N=new c.a,R={colorDomain:null,colorRange:M.b,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:"number",min:0,value:1},gridSize:{type:"array",min:0,value:[1,1]},gridOrigin:{type:"array",min:0,value:[0,0]},gridOffset:{type:"array",min:0,value:[0,0]},cellSize:{type:"number",min:0,max:1e3,value:1e3},offset:{type:"array",min:0,value:[1,1]},coverage:{type:"number",min:0,max:1,value:1},extruded:!0,fp64:!1,material:N},V=function(t){function e(){return Object(n.a)(this,e),Object(o.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(r.a)(e,t),Object(a.a)(e,[{key:"getShaders",value:function(){return{vs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-vertex-shader\n#define RANGE_COUNT 6\n\nin vec3 positions;\nin vec3 normals;\n\nin vec4 colors;\nin vec4 elevations;\nin vec3 instancePickingColors;\nuniform vec2 offset;\nuniform bool extruded;\nuniform float cellSize;\nuniform float coverage;\nuniform float opacity;\nuniform float elevationScale;\n\nuniform ivec2 gridSize;\nuniform vec2 gridOrigin;\nuniform vec2 gridOriginLow;\nuniform vec2 gridOffset;\nuniform vec2 gridOffsetLow;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 elevationRange;\nuniform vec2 colorDomain;\nuniform bool colorDomainValid;\nuniform vec2 elevationDomain;\nuniform bool elevationDomainValid;\n\nlayout(std140) uniform;\nuniform ColorData\n{\n  vec4 maxMinCount;\n} colorData;\nuniform ElevationData\n{\n  vec4 maxMinCount;\n} elevationData;\n\n#define EPSILON 0.00001\nout vec4 vColor;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  return outColor;\n}\n\nfloat linearScale(vec2 domain, vec2 range, float value) {\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    return ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;\n  }\n  return -1.;\n}\n\nvoid main(void) {\n\n  vec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);\n  vec4 color = quantizeScale(clrDomain, colorRange, colors.r);\n\n  float elevation = 0.0;\n\n  if (extruded) {\n    vec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);\n    elevation = linearScale(elvDomain, elevationRange, elevations.r);\n    elevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;\n  }\n  float shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);\n  float dotRadius = cellSize / 2. * coverage * shouldRender;\n\n  int yIndex = (gl_InstanceID / gridSize[0]);\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));\n  instancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));\n  vec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));\n  instancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));\n\n  vec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);\n  vec2 centroidPosition64xyLow = vec2(instancePositionXFP64[1], instancePositionYFP64[1]);\n  vec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);\n  picking_setPickingColor(instancePickingColors);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(normals);\n\n   if (extruded) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.;\n  }\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-fragment-shader\n\nprecision highp float;\n\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vColor;\n  fragColor = picking_filterColor(fragColor);\n}\n",modules:["project32","gouraud-lighting","picking","fp64"]}}},{key:"initializeState",value:function(){var t=this.context.gl;this.getAttributeManager().addInstanced({colors:{size:4,update:this.calculateColors,noAlloc:!0},elevations:{size:4,update:this.calculateElevations,noAlloc:!0}});var e=this._getModel(t);this._setupUniformBuffer(e),this.setState({model:e})}},{key:"_getModel",value:function(t){return new P.a(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new F,isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"draw",value:function(t){var e=t.uniforms,i=this.props,n=i.data,a=i.cellSize,o=i.offset,s=i.extruded,r=i.elevationScale,l=i.coverage,h=i.gridSize,u=i.gridOrigin,c=i.gridOffset,d=i.colorRange,p=i.elevationRange,g=[z(u[0]),z(u[1])],f=[z(c[0]),z(c[1])],v=n.color.maxMinBuffer,m=n.elevation.maxMinBuffer;v.bind({target:35345,index:0}),m.bind({target:35345,index:1});var y=this.getDomainUniforms();this.state.model.setUniforms(Object.assign({},e,y,{cellSize:a,offset:o,extruded:s,elevationScale:r,coverage:l,gridSize:h,gridOrigin:u,gridOriginLow:g,gridOffset:c,gridOffsetLow:f,colorRange:d,elevationRange:p})).draw(),v.unbind({target:35345,index:0}),m.unbind({target:35345,index:1})}},{key:"calculateColors",value:function(t){var e=this.props.data;t.update({buffer:e.color.aggregationBuffer})}},{key:"calculateElevations",value:function(t){var e=this.props.data;t.update({buffer:e.elevation.aggregationBuffer})}},{key:"getDomainUniforms",value:function(){var t=this.props,e=t.colorDomain,i=t.elevationDomain,n={};return null!==e?(n.colorDomainValid=!0,n.colorDomain=e):n.colorDomainValid=!1,null!==i?(n.elevationDomainValid=!0,n.elevationDomain=i):n.elevationDomainValid=!1,n}},{key:"_setupUniformBuffer",value:function(t){var e=this.context.gl,i=t.program.handle,n=e.getUniformBlockIndex(i,"ColorData"),a=e.getUniformBlockIndex(i,"ElevationData");e.uniformBlockBinding(i,n,0),e.uniformBlockBinding(i,a,1)}}]),e}(k.a);V.layerName="GPUGridCellLayer",V.defaultProps=R;var I=i(13);function B(t,e,i){var n=function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=1/0,o=-1/0,s=Object(y.a)(e),r=s.iterable,l=s.objectInfo,h=!0,u=!1,c=void 0;try{for(var d,p=r[Symbol.iterator]();!(h=(d=p.next()).done);h=!0){var g=d.value;l.index++,t=n(g,l)[1],Number.isFinite(t)&&(a=t<a?t:a,o=t>o?t:o)}}catch(t){u=!0,c=t}finally{try{h||null==p.return||p.return()}finally{if(u)throw c}}var f=(a+o)/2,v=U(i,f);if(v.xOffset<=0||v.yOffset<=0)return{gridHash:{},gridOffset:v};var m={};l.index=-1;var b=!0,_=!1,x=void 0;try{for(var w,C=r[Symbol.iterator]();!(b=(w=C.next()).done);b=!0){var M=w.value;l.index++;var k=n(M,l),P=Object(I.a)(k,2),S=P[0],E=P[1];if(Number.isFinite(E)&&Number.isFinite(S)){var O=Math.floor((E+90)/v.yOffset),j=Math.floor((S+180)/v.xOffset),A="".concat(O,"-").concat(j);m[A]=m[A]||{count:0,points:[]},m[A].count+=1,m[A].points.push(M)}}}catch(t){_=!0,x=t}finally{try{b||null==C.return||C.return()}finally{if(_)throw x}}return{gridHash:m,gridOffset:v}}(t,e,i),a=n.gridHash,o=n.gridOffset;return{gridHash:a,gridOffset:o,layerData:function(t,e){return Object.keys(t).reduce((function(i,n,a){var o=n.split("-"),s=parseInt(o[0],10),r=parseInt(o[1],10);return i.push(Object.assign({index:a,position:[e.xOffset*r-180,e.yOffset*s-90]},t[n])),i}),[])}(a,o)}}function U(t,e){var i;return{yOffset:t/6378e3*(180/Math.PI),xOffset:(i=e,t/6378e3*(180/Math.PI)/Math.cos(i*Math.PI/180))}}var H=new c.a,G={colorDomain:null,colorRange:M.b,getColorWeight:{type:"accessor",value:function(t){return 1}},colorAggregation:"SUM",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:"accessor",value:function(t){return 1}},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:function(t){return t.position}},extruded:!1,fp64:!1,material:H,gpuAggregation:!0},W=function(t){function e(){return Object(n.a)(this,e),Object(o.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(r.a)(e,t),Object(a.a)(e,[{key:"initializeState",value:function(){var t=this.context.gl,e=h.a.isSupported(t);e||d.a.error("GPUGridLayer is not supported on this browser, use GridLayer instead")();var i={id:"".concat(this.id,"-gpu-aggregator"),shaderCache:this.context.shaderCache};this.state={gpuGridAggregator:new h.a(t,i),isSupported:e}}},{key:"updateState",value:function(t){var e=this.getAggregationFlags(t);e&&(this.getLayerData(e),this.setState({gridHash:null}))}},{key:"finalizeState",value:function(){Object(u.a)(Object(s.a)(e.prototype),"finalizeState",this).call(this),this.state.gpuGridAggregator.delete()}},{key:"getAggregationFlags",value:function(t){var e=t.oldProps,i=t.props,n=t.changeFlags,a=null;return!!this.state.isSupported&&(this.isDataChanged({oldProps:e,props:i,changeFlags:n})&&(a=Object.assign({},a,{dataChanged:!0})),e.cellSize!==i.cellSize&&(a=Object.assign({},a,{cellSizeChanged:!0})),a)}},{key:"isDataChanged",value:function(t){var e=t.oldProps,i=t.props,n=t.changeFlags;return!!n.dataChanged||(e.gpuAggregation!==i.gpuAggregation||(e.colorAggregation!==i.colorAggregation||e.elevationAggregation!==i.elevationAggregation||!(!n.updateTriggersChanged||!(n.updateTriggersChanged.all||n.updateTriggersChanged.getPosition||n.updateTriggersChanged.getColorWeight||n.updateTriggersChanged.getElevationWeight))))}},{key:"getHashKeyForIndex",value:function(t){var e=this.state,i=e.gridSize,n=e.gridOrigin,a=e.cellSize,o=Math.floor(t/i[0]),s=t-o*i[0],r=Math.floor((o*a[1]+n[1]+90+a[1]/2)/a[1]),l=Math.floor((s*a[0]+n[0]+180+a[0]/2)/a[0]);return"".concat(r,"-").concat(l)}},{key:"getPositionForIndex",value:function(t){var e=this.state,i=e.gridSize,n=e.gridOrigin,a=e.cellSize,o=Math.floor(t/i[0]),s=t-o*i[0],r=o*a[1]+n[1];return[s*a[0]+n[0],r]}},{key:"getPickingInfo",value:function(t){var e=t.info,i=t.mode,n=e.index,a=null;if(n>=0){var o=this.state.gpuGridAggregator,s=this.getPositionForIndex(n),r=h.a.getAggregationData(Object.assign({pixelIndex:n},o.getData("color"))),l=h.a.getAggregationData(Object.assign({pixelIndex:n},o.getData("elevation")));if(a={colorValue:r.cellWeight,elevationValue:l.cellWeight,count:r.cellCount||l.cellCount,position:s,totalCount:r.totalCount||l.totalCount},"hover"!==i){var u=this.props,c=u.data,d=u.getPosition,p=this.state.gridHash;if(!p)p=B(c,this.props.cellSize,d).gridHash,this.setState({gridHash:p});var g=p[this.getHashKeyForIndex(n)];Object.assign(a,g)}}return Object.assign(e,{picked:Boolean(a),object:a})}},{key:"getLayerData",value:function(t){var e=this.props,i=e.data,n=e.cellSize,a=e.getPosition,o=e.gpuAggregation,s=e.getColorWeight,r=e.colorAggregation,l=e.getElevationWeight,h=e.elevationAggregation,u=e.fp64,c=w({data:i,cellSizeMeters:n,getPosition:a,weightParams:{color:{getWeight:s,operation:p.a[r]||p.a[G.colorAggregation],needMin:!0,needMax:!0,combineMaxMin:!0},elevation:{getWeight:l,operation:p.a[h]||p.a[G.elevationAggregation],needMin:!0,needMax:!0,combineMaxMin:!0}},gpuAggregation:o,gpuGridAggregator:this.state.gpuGridAggregator,boundingBox:this.state.boundingBox,aggregationFlags:t,fp64:u}),d=c.weights,g=c.gridSize,f=c.gridOrigin,v=c.cellSize,m=c.boundingBox;this.setState({weights:d,gridSize:g,gridOrigin:f,cellSize:v,boundingBox:m})}},{key:"renderLayers",value:function(){if(!this.state.isSupported)return null;var t=this.props,e=t.elevationScale,i=t.fp64,n=t.extruded,a=t.cellSize,o=t.coverage,s=t.material,r=t.elevationRange,l=t.colorDomain,h=t.elevationDomain,u=this.state,c=u.weights,d=u.gridSize,p=u.gridOrigin,g=u.cellSize,f=Object(M.a)(this.props.colorRange,Float32Array,255);return new(this.getSubLayerClass("gpu-grid-cell",V))({gridSize:d,gridOrigin:p,gridOffset:g,colorRange:f,elevationRange:r,colorDomain:l,elevationDomain:h,fp64:i,cellSize:a,coverage:o,material:s,elevationScale:e,extruded:n},this.getSubLayerProps({id:"gpu-grid-cell"}),{data:c,numInstances:d[0]*d[1]})}}]),e}(l.a);W.layerName="GPUGridLayer",W.defaultProps=G;var q=function(t){function e(){return Object(n.a)(this,e),Object(o.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(r.a)(e,t),Object(a.a)(e,[{key:"getGeometry",value:function(t){return new F}},{key:"draw",value:function(t){var e=t.uniforms,i=this.props,n=i.elevationScale,a=i.extruded,o=i.offset,s=i.coverage,r=i.cellSize,l=i.angle;this.state.model.setUniforms(Object.assign({},e,{radius:r/2,angle:l,offset:o,extruded:a,coverage:s,elevationScale:n,edgeDistance:1,isWireframe:!1})).draw()}}]),e}(i(4464).a);q.layerName="GridCellLayer",q.defaultProps={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",min:0,value:[1,1]}};var X=i(4383),Y=i(4384);function K(){}var Z=new c.a,$={colorDomain:null,colorRange:M.b,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:function(t){return 1}},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},onSetColorDomain:K,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:function(t){return 1}},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:1,onSetElevationDomain:K,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:function(t){return t.position}},extruded:!1,fp64:!1,material:Z},Q=["getColorValue","colorAggregation","getColorWeight"],J=["getElevationValue","elevationAggregation","getElevationWeight"],tt=function(t){function e(){return Object(n.a)(this,e),Object(o.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(r.a)(e,t),Object(a.a)(e,[{key:"initializeState",value:function(){this.state={layerData:[],sortedColorBins:null,sortedElevationBins:null,colorValueDomain:null,elevationValueDomain:null,colorScaleFunc:K,elevationScaleFunc:K,dimensionUpdaters:this.getDimensionUpdaters()}}},{key:"updateState",value:function(t){var e=this,i=t.oldProps,n=t.props,a=t.changeFlags;this.updateGetValueFuncs(i,n);var o=this.needsReProjectPoints(i,n,a);a.dataChanged||o?this.getLayerData():(this.getDimensionChanges(i,n)||[]).forEach((function(t){return"function"==typeof t&&t.apply(e)}))}},{key:"colorElevationPropsChanged",value:function(t,e){for(var i=!1,n=!1,a=0;a<Q.length;a++){var o=Q[a];t[o]!==e[o]&&(i=!0)}for(var s=0;s<J.length;s++){var r=J[s];t[r]!==e[r]&&(n=!0)}return{colorChanged:i,elevationChanged:n}}},{key:"updateGetValueFuncs",value:function(t,e){var i=e.getColorValue,n=e.getElevationValue,a=this.props,o=a.colorAggregation,s=a.getColorWeight,r=a.elevationAggregation,l=a.getElevationWeight,h=this.colorElevationPropsChanged(t,e),u=h.colorChanged,c=h.elevationChanged;u&&null===i&&(i=Object(p.b)(o,s)),c&&null===n&&(n=Object(p.b)(r,l)),i&&this.setState({getColorValue:i}),n&&this.setState({getElevationValue:n})}},{key:"needsReProjectPoints",value:function(t,e,i){return t.cellSize!==e.cellSize||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPosition)}},{key:"getDimensionUpdaters",value:function(){return{getFillColor:[{id:"value",triggers:["getColorValue","getColorWeight","colorAggregation"],updater:this.getSortedColorBins},{id:"domain",triggers:["lowerPercentile","upperPercentile"],updater:this.getColorValueDomain},{id:"scaleFunc",triggers:["colorDomain","colorRange"],updater:this.getColorScale}],getElevation:[{id:"value",triggers:["getElevationValue","getElevationWeight","elevationAggregation"],updater:this.getSortedElevationBins},{id:"domain",triggers:["elevationLowerPercentile","elevationUpperPercentile"],updater:this.getElevationValueDomain},{id:"scaleFunc",triggers:["elevationDomain","elevationRange"],updater:this.getElevationScale}]}}},{key:"getDimensionChanges",value:function(t,e){var i=this.state.dimensionUpdaters,n=[];for(var a in i){var o=i[a].find((function(i){return i.triggers.some((function(i){return t[i]!==e[i]}))}));o&&n.push(o.updater)}return n.length?n:null}},{key:"getPickingInfo",value:function(t){var e=t.info,i=this.state,n=i.sortedColorBins,a=i.sortedElevationBins,o=null;if(e.picked&&e.index>-1){var s=this.state.layerData[e.index],r=n.binMap[s.index]&&n.binMap[s.index].value,l=a.binMap[s.index]&&a.binMap[s.index].value;o=Object.assign({colorValue:r,elevationValue:l},s)}return Object.assign(e,{picked:Boolean(o),object:o})}},{key:"getUpdateTriggers",value:function(){var t=this,e=this.state.dimensionUpdaters,i={},n=function(n){i[n]={};var a=!0,o=!1,s=void 0;try{for(var r,l=e[n][Symbol.iterator]();!(a=(r=l.next()).done);a=!0){r.value.triggers.forEach((function(e){i[n][e]=t.props[e]}))}}catch(t){o=!0,s=t}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}};for(var a in e)n(a);return i}},{key:"getLayerData",value:function(){var t=this.props,e=B(t.data,t.cellSize,t.getPosition).layerData;this.setState({layerData:e}),this.getSortedBins()}},{key:"getValueDomain",value:function(){this.getColorValueDomain(),this.getElevationValueDomain()}},{key:"getSortedBins",value:function(){this.getSortedColorBins(),this.getSortedElevationBins()}},{key:"getSortedColorBins",value:function(){var t=this.state.getColorValue,e=new X.a(this.state.layerData||[],t);this.setState({sortedColorBins:e}),this.getColorValueDomain()}},{key:"getSortedElevationBins",value:function(){var t=this.state.getElevationValue,e=new X.a(this.state.layerData||[],t);this.setState({sortedElevationBins:e}),this.getElevationValueDomain()}},{key:"getColorValueDomain",value:function(){var t=this.props,e=t.lowerPercentile,i=t.upperPercentile,n=t.onSetColorDomain;this.state.colorValueDomain=this.state.sortedColorBins.getValueRange([e,i]),"function"==typeof n&&n(this.state.colorValueDomain),this.getColorScale()}},{key:"getElevationValueDomain",value:function(){var t=this.props,e=t.elevationLowerPercentile,i=t.elevationUpperPercentile,n=t.onSetElevationDomain;this.state.elevationValueDomain=this.state.sortedElevationBins.getValueRange([e,i]),"function"==typeof n&&n(this.state.elevationValueDomain),this.getElevationScale()}},{key:"getColorScale",value:function(){var t=this.props.colorRange,e=this.props.colorDomain||this.state.colorValueDomain;this.state.colorScaleFunc=Object(Y.b)(e,t)}},{key:"getElevationScale",value:function(){var t=this.props.elevationRange,e=this.props.elevationDomain||this.state.elevationValueDomain;this.state.elevationScaleFunc=Object(Y.a)(e,t)}},{key:"_onGetSublayerColor",value:function(t){var e=this.state,i=e.sortedColorBins,n=e.colorScaleFunc,a=e.colorValueDomain,o=i.binMap[t.index]&&i.binMap[t.index].value,s=this.props.colorDomain||a,r=o>=s[0]&&o<=s[s.length-1]?n(o):[0,0,0,0];return r[3]=Number.isFinite(r[3])?r[3]:255,r}},{key:"_onGetSublayerElevation",value:function(t){var e=this.state,i=e.sortedElevationBins,n=e.elevationScaleFunc,a=e.elevationValueDomain,o=i.binMap[t.index]&&i.binMap[t.index].value,s=this.props.elevationDomain||a;return o>=s[0]&&o<=s[s.length-1]?n(o):-1}},{key:"renderLayers",value:function(){var t=this.props,e=t.elevationScale,i=t.fp64,n=t.extruded,a=t.cellSize,o=t.coverage,s=t.material,r=t.transitions;return new(this.getSubLayerClass("grid-cell",q))({fp64:i,cellSize:a,coverage:o,material:s,elevationScale:e,extruded:n,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:r&&{getFillColor:r.getColorValue||r.getColorWeight,getElevation:r.getElevationValue||r.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:this.getUpdateTriggers()}),{data:this.state.layerData})}}]),e}(l.a);tt.layerName="CPUGridLayer",tt.defaultProps=$;var et=Object.assign({},W.defaultProps,tt.defaultProps,{gpuAggregation:!1}),it=function(t){function e(){return Object(n.a)(this,e),Object(o.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(r.a)(e,t),Object(a.a)(e,[{key:"initializeState",value:function(){this.state={useGPUAggregation:!0}}},{key:"updateState",value:function(t){t.oldProps;var e=t.props,i=(t.changeFlags,{});i.useGPUAggregation=this.canUseGPUAggregation(e),this.setState(i)}},{key:"renderLayers",value:function(){var t=this.props,e=t.data,i=t.updateTriggers,n=this.state.useGPUAggregation?"GPU":"CPU";return new(this.state.useGPUAggregation?this.getSubLayerClass("GPU",W):this.getSubLayerClass("CPU",tt))(this.props,this.getSubLayerProps({id:n,updateTriggers:i}),{data:e})}},{key:"canUseGPUAggregation",value:function(t){var e=t.gpuAggregation,i=t.lowerPercentile,n=t.upperPercentile,a=t.getColorValue,o=t.getElevationValue;return!!e&&(!!h.a.isSupported(this.context.gl)&&(0===i&&100===n&&(null===a&&null===o)))}}]),e}(l.a);it.layerName="GridLayer",it.defaultProps=et;var nt=i(0),at=i.n(nt),ot=i(18),st=i(4313),rt=i(4307),lt=i(4321),ht=i(4314);function ut(){return(ut=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function ct(t){return at.a.createElement("div",{className:"deckgl-tooltip"},at.a.createElement(ht.a,{label:Object(ot.e)("Longitude and Latitude")+": ",value:t.coordinate[0]+", "+t.coordinate[1]}),at.a.createElement(ht.a,{label:Object(ot.e)("Height")+": ",value:""+t.object.elevationValue}))}function dt(t,e,i,n){const a=t,o=a.color_picker;let s=e.data.features.map(t=>ut({},t,{color:[o.r,o.g,o.b,255*o.a]}));if(a.js_data_mutator){s=Object(rt.a)(a.js_data_mutator)(s)}const r=Object(st.b)(a.js_agg_function,t=>t.weight);return new it(ut({id:"grid-layer-"+a.slice_id,data:s,pickable:!0,cellSize:a.grid_size,minColor:[0,0,0,0],extruded:a.extruded,maxColor:[o.r,o.g,o.b,255*o.a],outline:!1,getElevationValue:r,getColorValue:r},Object(st.a)(a,n,ct)))}e.default=Object(lt.b)(dt,(function(t){return t.map(t=>t.position)}))}}]);