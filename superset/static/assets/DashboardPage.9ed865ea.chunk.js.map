{"version":3,"sources":["webpack:///./src/common/hooks/apiResources/apiResources.ts","webpack:///./src/common/hooks/apiResources/charts.ts","webpack:///./src/common/hooks/apiResources/dashboards.ts","webpack:///./src/common/hooks/apiResources/index.ts","webpack:///./src/dashboard/containers/DashboardPage.tsx","webpack:///./src/dashboard/util/injectCustomCss.ts"],"names":[],"mappings":"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","file":"DashboardPage.9ed865ea.chunk.js","sourcesContent":["/**\r\n * Licensed to the Apache Software Foundation (ASF) under one\r\n * or more contributor license agreements.  See the NOTICE file\r\n * distributed with this work for additional information\r\n * regarding copyright ownership.  The ASF licenses this file\r\n * to you under the Apache License, Version 2.0 (the\r\n * \"License\"); you may not use this file except in compliance\r\n * with the License.  You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing,\r\n * software distributed under the License is distributed on an\r\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n * KIND, either express or implied.  See the License for the\r\n * specific language governing permissions and limitations\r\n * under the License.\r\n */\r\n\r\nimport { makeApi } from '@superset-ui/core';\r\nimport { useEffect, useMemo, useRef, useState } from 'react';\r\n\r\nexport enum ResourceStatus {\r\n  LOADING = 'loading',\r\n  COMPLETE = 'complete',\r\n  ERROR = 'error',\r\n}\r\n\r\n/**\r\n * An object containing the data fetched from the API,\r\n * as well as loading and error info\r\n */\r\nexport type Resource<T> = LoadingState | CompleteState<T> | ErrorState;\r\n\r\n// Trying out something a little different: a separate type per status.\r\n// This should let Typescript know whether a Resource has a result or error.\r\n// It's possible that I'm expecting too much from Typescript here.\r\n// If this ends up causing problems, we can change the type to:\r\n//\r\n// export type Resource<T> = {\r\n//   status: ResourceStatus;\r\n//   result: null | T;\r\n//   error: null | Error;\r\n// }\r\n\r\ntype LoadingState = {\r\n  status: ResourceStatus.LOADING;\r\n  result: null;\r\n  error: null;\r\n};\r\n\r\ntype CompleteState<T> = {\r\n  status: ResourceStatus.COMPLETE;\r\n  result: T;\r\n  error: null;\r\n};\r\n\r\ntype ErrorState = {\r\n  status: ResourceStatus.ERROR;\r\n  result: null;\r\n  error: Error;\r\n};\r\n\r\nconst initialState: LoadingState = {\r\n  status: ResourceStatus.LOADING,\r\n  result: null,\r\n  error: null,\r\n};\r\n\r\n/**\r\n * A general-purpose hook to fetch the response from an endpoint.\r\n * Returns the full response body from the API, including metadata.\r\n *\r\n * Note: You likely want {useApiV1Resource} instead of this!\r\n *\r\n * TODO Store the state in redux or something, share state between hook instances.\r\n *\r\n * TODO Include a function in the returned resource object to refresh the data.\r\n *\r\n * A core design decision here is composition > configuration,\r\n * and every hook should only have one job.\r\n * Please address new needs with new hooks if possible,\r\n * rather than adding config options to this hook.\r\n *\r\n * @param endpoint The url where the resource is located.\r\n */\r\nexport function useApiResourceFullBody<RESULT>(\r\n  endpoint: string,\r\n): Resource<RESULT> {\r\n  const [resource, setResource] = useState<Resource<RESULT>>(initialState);\r\n  const cancelRef = useRef<() => void>(() => {});\r\n\r\n  useEffect(() => {\r\n    // If refresh is implemented, this will need to change.\r\n    // The previous values should stay during refresh.\r\n    setResource(initialState);\r\n\r\n    // when this effect runs, the endpoint has changed.\r\n    // cancel any current calls so that state doesn't get messed up.\r\n    cancelRef.current();\r\n    let cancelled = false;\r\n    cancelRef.current = () => {\r\n      cancelled = true;\r\n    };\r\n\r\n    const fetchResource = makeApi<{}, RESULT>({\r\n      method: 'GET',\r\n      endpoint,\r\n    });\r\n\r\n    fetchResource({})\r\n      .then(result => {\r\n        if (!cancelled) {\r\n          setResource({\r\n            status: ResourceStatus.COMPLETE,\r\n            result,\r\n            error: null,\r\n          });\r\n        }\r\n      })\r\n      .catch(error => {\r\n        if (!cancelled) {\r\n          setResource({\r\n            status: ResourceStatus.ERROR,\r\n            result: null,\r\n            error,\r\n          });\r\n        }\r\n      });\r\n\r\n    // Cancel the request when the component un-mounts\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [endpoint]);\r\n\r\n  return resource;\r\n}\r\n\r\n/**\r\n * For when you want to transform the result of an api resource hook before using it.\r\n *\r\n * @param resource the Resource object returned from useApiV1Resource\r\n * @param transformFn a callback that transforms the result object into the shape you want.\r\n * Make sure to use a persistent function for this so it doesn't constantly recalculate!\r\n */\r\nexport function useTransformedResource<IN, OUT>(\r\n  resource: Resource<IN>,\r\n  transformFn: (result: IN) => OUT,\r\n): Resource<OUT> {\r\n  return useMemo(() => {\r\n    if (resource.status !== ResourceStatus.COMPLETE) {\r\n      // While incomplete, there is no result - no need to transform.\r\n      return resource;\r\n    }\r\n    return {\r\n      ...resource,\r\n      result: transformFn(resource.result),\r\n    };\r\n  }, [resource, transformFn]);\r\n}\r\n\r\n// returns the \"result\" field from a fetched API v1 endpoint\r\nconst extractInnerResult = <T>(responseBody: { result: T }) =>\r\n  responseBody.result;\r\n\r\n/**\r\n * A general-purpose hook to fetch a Superset resource from a v1 API endpoint.\r\n * Handles request lifecycle and async logic so you don't have to.\r\n *\r\n * This returns the data under the \"result\" field in the API response body.\r\n * If you need the full response body, use {useFullApiResource} instead.\r\n *\r\n * @param endpoint The url where the resource is located.\r\n */\r\nexport function useApiV1Resource<RESULT>(endpoint: string): Resource<RESULT> {\r\n  return useTransformedResource(\r\n    useApiResourceFullBody<{ result: RESULT }>(endpoint),\r\n    extractInnerResult,\r\n  );\r\n}\r\n","/**\r\n * Licensed to the Apache Software Foundation (ASF) under one\r\n * or more contributor license agreements.  See the NOTICE file\r\n * distributed with this work for additional information\r\n * regarding copyright ownership.  The ASF licenses this file\r\n * to you under the Apache License, Version 2.0 (the\r\n * \"License\"); you may not use this file except in compliance\r\n * with the License.  You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing,\r\n * software distributed under the License is distributed on an\r\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n * KIND, either express or implied.  See the License for the\r\n * specific language governing permissions and limitations\r\n * under the License.\r\n */\r\n\r\nimport rison from 'rison';\r\nimport Chart from 'src/types/Chart';\r\nimport { useApiV1Resource, useTransformedResource } from './apiResources';\r\n\r\nfunction extractOwnerNames({ owners }: Chart) {\r\n  if (!owners) return null;\r\n  return owners.map(owner => `${owner.first_name} ${owner.last_name}`);\r\n}\r\n\r\nconst ownerNamesQuery = rison.encode({\r\n  columns: ['owners.first_name', 'owners.last_name'],\r\n  keys: ['none'],\r\n});\r\n\r\nexport function useChartOwnerNames(chartId: string) {\r\n  return useTransformedResource(\r\n    useApiV1Resource<Chart>(`/api/v1/chart/${chartId}?q=${ownerNamesQuery}`),\r\n    extractOwnerNames,\r\n  );\r\n}\r\n","/**\r\n * Licensed to the Apache Software Foundation (ASF) under one\r\n * or more contributor license agreements.  See the NOTICE file\r\n * distributed with this work for additional information\r\n * regarding copyright ownership.  The ASF licenses this file\r\n * to you under the Apache License, Version 2.0 (the\r\n * \"License\"); you may not use this file except in compliance\r\n * with the License.  You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing,\r\n * software distributed under the License is distributed on an\r\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n * KIND, either express or implied.  See the License for the\r\n * specific language governing permissions and limitations\r\n * under the License.\r\n */\r\n\r\nimport Dashboard from 'src/types/Dashboard';\r\nimport { useApiV1Resource, useTransformedResource } from './apiResources';\r\n\r\nexport const useDashboard = (idOrSlug: string | number) =>\r\n  useTransformedResource(\r\n    useApiV1Resource<Dashboard>(`/api/v1/dashboard/${idOrSlug}`),\r\n    dashboard => ({\r\n      ...dashboard,\r\n      metadata: dashboard.json_metadata && JSON.parse(dashboard.json_metadata),\r\n      position_data:\r\n        dashboard.position_json && JSON.parse(dashboard.position_json),\r\n    }),\r\n  );\r\n\r\n// gets the chart definitions for a dashboard\r\nexport const useDashboardCharts = (idOrSlug: string | number) =>\r\n  useApiV1Resource(`/api/v1/dashboard/${idOrSlug}/charts`);\r\n\r\n// gets the datasets for a dashboard\r\n// important: this endpoint only returns the fields in the dataset\r\n// that are necessary for rendering the given dashboard\r\nexport const useDashboardDatasets = (idOrSlug: string | number) =>\r\n  useApiV1Resource(`/api/v1/dashboard/${idOrSlug}/datasets`);\r\n","/**\r\n * Licensed to the Apache Software Foundation (ASF) under one\r\n * or more contributor license agreements.  See the NOTICE file\r\n * distributed with this work for additional information\r\n * regarding copyright ownership.  The ASF licenses this file\r\n * to you under the Apache License, Version 2.0 (the\r\n * \"License\"); you may not use this file except in compliance\r\n * with the License.  You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing,\r\n * software distributed under the License is distributed on an\r\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n * KIND, either express or implied.  See the License for the\r\n * specific language governing permissions and limitations\r\n * under the License.\r\n */\r\n\r\nexport {\r\n  useApiResourceFullBody,\r\n  useApiV1Resource,\r\n  useTransformedResource,\r\n} from './apiResources';\r\n\r\n// A central catalog of API Resource hooks.\r\n// Add new API hooks here, organized under\r\n// different files for different resource types.\r\nexport * from './charts';\r\nexport * from './dashboards';\r\n","/**\r\n * Licensed to the Apache Software Foundation (ASF) under one\r\n * or more contributor license agreements.  See the NOTICE file\r\n * distributed with this work for additional information\r\n * regarding copyright ownership.  The ASF licenses this file\r\n * to you under the Apache License, Version 2.0 (the\r\n * \"License\"); you may not use this file except in compliance\r\n * with the License.  You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing,\r\n * software distributed under the License is distributed on an\r\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n * KIND, either express or implied.  See the License for the\r\n * specific language governing permissions and limitations\r\n * under the License.\r\n */\r\nimport React, { useEffect, useState, FC } from 'react';\r\nimport { useDispatch } from 'react-redux';\r\nimport { useParams } from 'react-router-dom';\r\nimport Loading from 'src/components/Loading';\r\nimport {\r\n  useDashboard,\r\n  useDashboardCharts,\r\n  useDashboardDatasets,\r\n} from 'src/common/hooks/apiResources';\r\nimport { ResourceStatus } from 'src/common/hooks/apiResources/apiResources';\r\nimport { hydrateDashboard } from 'src/dashboard/actions/hydrate';\r\nimport injectCustomCss from 'src/dashboard/util/injectCustomCss';\r\n\r\nconst DashboardContainer = React.lazy(\r\n  () =>\r\n    import(\r\n      /* webpackChunkName: \"DashboardContainer\" */\r\n      /* webpackPreload: true */\r\n      'src/dashboard/containers/Dashboard'\r\n    ),\r\n);\r\n\r\nconst DashboardPage: FC = () => {\r\n  const dispatch = useDispatch();\r\n  const { idOrSlug } = useParams<{ idOrSlug: string }>();\r\n  const [isHydrated, setHydrated] = useState(false);\r\n  const dashboardResource = useDashboard(idOrSlug);\r\n  const chartsResource = useDashboardCharts(idOrSlug);\r\n  const datasetsResource = useDashboardDatasets(idOrSlug);\r\n  const error = [dashboardResource, chartsResource, datasetsResource].find(\r\n    resource => resource.status === ResourceStatus.ERROR,\r\n  )?.error;\r\n\r\n  useEffect(() => {\r\n    if (dashboardResource.result) {\r\n      document.title = dashboardResource.result.dashboard_title;\r\n      if (dashboardResource.result.css) {\r\n        // returning will clean up custom css\r\n        // when dashboard unmounts or changes\r\n        return injectCustomCss(dashboardResource.result.css);\r\n      }\r\n    }\r\n    return () => {};\r\n  }, [dashboardResource.result]);\r\n\r\n  const shouldBeHydrated =\r\n    dashboardResource.status === ResourceStatus.COMPLETE &&\r\n    chartsResource.status === ResourceStatus.COMPLETE &&\r\n    datasetsResource.status === ResourceStatus.COMPLETE;\r\n\r\n  useEffect(() => {\r\n    if (shouldBeHydrated) {\r\n      dispatch(\r\n        hydrateDashboard(\r\n          dashboardResource.result,\r\n          chartsResource.result,\r\n          datasetsResource.result,\r\n        ),\r\n      );\r\n      setHydrated(true);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [shouldBeHydrated]);\r\n\r\n  if (error) throw error; // caught in error boundary\r\n  if (!isHydrated) return <Loading />;\r\n  return <DashboardContainer />;\r\n};\r\n\r\nexport default DashboardPage;\r\n","/**\r\n * Licensed to the Apache Software Foundation (ASF) under one\r\n * or more contributor license agreements.  See the NOTICE file\r\n * distributed with this work for additional information\r\n * regarding copyright ownership.  The ASF licenses this file\r\n * to you under the Apache License, Version 2.0 (the\r\n * \"License\"); you may not use this file except in compliance\r\n * with the License.  You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing,\r\n * software distributed under the License is distributed on an\r\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n * KIND, either express or implied.  See the License for the\r\n * specific language governing permissions and limitations\r\n * under the License.\r\n */\r\n\r\nfunction createStyleElement(className: string) {\r\n  const style = document.createElement('style');\r\n  style.className = className;\r\n  style.type = 'text/css';\r\n  return style;\r\n}\r\n\r\n// The original, non-typescript code referenced `style.styleSheet`.\r\n// I can't find what sort of element would have a styleSheet property,\r\n// so have created this type to satisfy TS without changing behavior.\r\ntype MysteryStyleElement = {\r\n  styleSheet: {\r\n    cssText: string;\r\n  };\r\n};\r\n\r\nexport default function injectCustomCss(css: string) {\r\n  const className = 'CssEditor-css';\r\n  const head = document.head || document.getElementsByTagName('head')[0];\r\n  const style: HTMLStyleElement =\r\n    document.querySelector(`.${className}`) || createStyleElement(className);\r\n\r\n  if ('styleSheet' in style) {\r\n    (style as MysteryStyleElement).styleSheet.cssText = css;\r\n  } else {\r\n    style.innerHTML = css;\r\n  }\r\n\r\n  /**\r\n   * Ensures that the style applied is always the last.\r\n   *\r\n   * from: https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild\r\n   * The Node.appendChild() method adds a node to the end of the list of children\r\n   * of a specified parent node. If the given child is a reference to an existing\r\n   * node in the document, appendChild() moves it from its current position to the\r\n   * new position (there is no requirement to remove the node from its parent node\r\n   * before appending it to some other node).\r\n   */\r\n\r\n  head.appendChild(style);\r\n\r\n  return function removeCustomCSS() {\r\n    style.remove();\r\n  };\r\n}\r\n"],"sourceRoot":""}