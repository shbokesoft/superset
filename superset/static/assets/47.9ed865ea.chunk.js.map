{"version":3,"sources":["webpack:///./src/filters/components/Range/RangeFilterPlugin.tsx","webpack:///./src/filters/components/common.ts","webpack:///./src/filters/utils.ts"],"names":[],"mappings":"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","file":"47.9ed865ea.chunk.js","sourcesContent":["/**\r\n * Licensed to the Apache Software Foundation (ASF) under one\r\n * or more contributor license agreements.  See the NOTICE file\r\n * distributed with this work for additional information\r\n * regarding copyright ownership.  The ASF licenses this file\r\n * to you under the Apache License, Version 2.0 (the\r\n * \"License\"); you may not use this file except in compliance\r\n * with the License.  You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing,\r\n * software distributed under the License is distributed on an\r\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n * KIND, either express or implied.  See the License for the\r\n * specific language governing permissions and limitations\r\n * under the License.\r\n */\r\nimport { getNumberFormatter, NumberFormats, t } from '@superset-ui/core';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { Slider } from 'src/common/components';\r\nimport { PluginFilterRangeProps } from './types';\r\nimport { Styles } from '../common';\r\nimport { getRangeExtraFormData } from '../../utils';\r\n\r\nexport default function RangeFilterPlugin(props: PluginFilterRangeProps) {\r\n  const {\r\n    data,\r\n    formData,\r\n    height,\r\n    width,\r\n    setDataMask,\r\n    setFocusedFilter,\r\n    unsetFocusedFilter,\r\n    inputRef,\r\n    filterState,\r\n  } = props;\r\n  const numberFormatter = getNumberFormatter(NumberFormats.SMART_NUMBER);\r\n\r\n  const [row] = data;\r\n  // @ts-ignore\r\n  const { min, max }: { min: number; max: number } = row;\r\n  const { groupby, defaultValue } = formData;\r\n  const [col = ''] = groupby || [];\r\n  const [value, setValue] = useState<[number, number]>(\r\n    defaultValue ?? [min, max],\r\n  );\r\n  const [marks, setMarks] = useState<{ [key: number]: string }>({});\r\n\r\n  const getBounds = (\r\n    value: [number, number],\r\n  ): { lower: number | null; upper: number | null } => {\r\n    const [lowerRaw, upperRaw] = value;\r\n    return {\r\n      lower: lowerRaw > min ? lowerRaw : null,\r\n      upper: upperRaw < max ? upperRaw : null,\r\n    };\r\n  };\r\n\r\n  const getLabel = (lower: number | null, upper: number | null): string => {\r\n    if (lower !== null && upper !== null) {\r\n      return `${numberFormatter(lower)} ≤ x ≤ ${numberFormatter(upper)}`;\r\n    }\r\n    if (lower !== null) {\r\n      return `x ≥ ${numberFormatter(lower)}`;\r\n    }\r\n    if (upper !== null) {\r\n      return `x ≤ ${numberFormatter(upper)}`;\r\n    }\r\n    return '';\r\n  };\r\n\r\n  const getMarks = (\r\n    lower: number | null,\r\n    upper: number | null,\r\n  ): { [key: number]: string } => {\r\n    const newMarks: { [key: number]: string } = {};\r\n    if (lower !== null) {\r\n      newMarks[lower] = numberFormatter(lower);\r\n    }\r\n    if (upper !== null) {\r\n      newMarks[upper] = numberFormatter(upper);\r\n    }\r\n    return newMarks;\r\n  };\r\n\r\n  const handleAfterChange = (value: [number, number]): void => {\r\n    setValue(value);\r\n    const { lower, upper } = getBounds(value);\r\n    setMarks(getMarks(lower, upper));\r\n\r\n    setDataMask({\r\n      extraFormData: getRangeExtraFormData(col, lower, upper),\r\n      filterState: {\r\n        value: lower !== null || upper !== null ? value : null,\r\n        label: getLabel(lower, upper),\r\n      },\r\n    });\r\n  };\r\n\r\n  const handleChange = (value: [number, number]) => {\r\n    setValue(value);\r\n  };\r\n\r\n  useEffect(() => {\r\n    handleAfterChange(filterState.value ?? [min, max]);\r\n  }, [JSON.stringify(filterState.value)]);\r\n\r\n  return (\r\n    <Styles height={height} width={width}>\r\n      {Number.isNaN(Number(min)) || Number.isNaN(Number(max)) ? (\r\n        <h4>{t('Chosen non-numeric column')}</h4>\r\n      ) : (\r\n        <div onMouseEnter={setFocusedFilter} onMouseLeave={unsetFocusedFilter}>\r\n          <Slider\r\n            range\r\n            min={min}\r\n            max={max}\r\n            value={value ?? [min, max]}\r\n            onAfterChange={handleAfterChange}\r\n            onChange={handleChange}\r\n            tipFormatter={value => numberFormatter(value)}\r\n            ref={inputRef}\r\n            marks={marks}\r\n          />\r\n        </div>\r\n      )}\r\n    </Styles>\r\n  );\r\n}\r\n","/**\r\n * Licensed to the Apache Software Foundation (ASF) under one\r\n * or more contributor license agreements.  See the NOTICE file\r\n * distributed with this work for additional information\r\n * regarding copyright ownership.  The ASF licenses this file\r\n * to you under the Apache License, Version 2.0 (the\r\n * \"License\"); you may not use this file except in compliance\r\n * with the License.  You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing,\r\n * software distributed under the License is distributed on an\r\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n * KIND, either express or implied.  See the License for the\r\n * specific language governing permissions and limitations\r\n * under the License.\r\n */\r\nimport { styled } from '@superset-ui/core';\r\nimport { Select } from 'src/common/components';\r\nimport { PluginFilterStylesProps } from './types';\r\n\r\nexport const Styles = styled.div<PluginFilterStylesProps>`\r\n  height: ${({ height }) => height}px;\r\n  width: ${({ width }) => width}px;\r\n`;\r\n\r\nexport const StyledSelect = styled(Select)`\r\n  width: 100%;\r\n`;\r\n","/**\r\n * Licensed to the Apache Software Foundation (ASF) under one\r\n * or more contributor license agreements.  See the NOTICE file\r\n * distributed with this work for additional information\r\n * regarding copyright ownership.  The ASF licenses this file\r\n * to you under the Apache License, Version 2.0 (the\r\n * \"License\"); you may not use this file except in compliance\r\n * with the License.  You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing,\r\n * software distributed under the License is distributed on an\r\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n * KIND, either express or implied.  See the License for the\r\n * specific language governing permissions and limitations\r\n * under the License.\r\n */\r\nimport {\r\n  DataRecordValue,\r\n  GenericDataType,\r\n  NumberFormatter,\r\n  QueryObjectFilterClause,\r\n  TimeFormatter,\r\n  ExtraFormData,\r\n} from '@superset-ui/core';\r\nimport { FALSE_STRING, NULL_STRING, TRUE_STRING } from 'src/utils/common';\r\n\r\nexport const getSelectExtraFormData = (\r\n  col: string,\r\n  value?: null | (string | number)[],\r\n  emptyFilter = false,\r\n  inverseSelection = false,\r\n): ExtraFormData => {\r\n  const extra: ExtraFormData = {};\r\n  if (emptyFilter) {\r\n    extra.adhoc_filters = [\r\n      {\r\n        expressionType: 'SQL',\r\n        clause: 'WHERE',\r\n        sqlExpression: '1 = 0',\r\n      },\r\n    ];\r\n  } else if (value !== undefined && value !== null && value.length !== 0) {\r\n    extra.filters = [\r\n      {\r\n        col,\r\n        op: inverseSelection ? ('NOT IN' as const) : ('IN' as const),\r\n        val: value,\r\n      },\r\n    ];\r\n  }\r\n  return extra;\r\n};\r\n\r\nexport const getRangeExtraFormData = (\r\n  col: string,\r\n  lower?: number | null,\r\n  upper?: number | null,\r\n) => {\r\n  const filters: QueryObjectFilterClause[] = [];\r\n  if (lower !== undefined && lower !== null) {\r\n    filters.push({ col, op: '>=', val: lower });\r\n  }\r\n  if (upper !== undefined && upper !== null) {\r\n    filters.push({ col, op: '<=', val: upper });\r\n  }\r\n\r\n  return filters.length\r\n    ? {\r\n        filters,\r\n      }\r\n    : {};\r\n};\r\n\r\nexport interface DataRecordValueFormatter {\r\n  (value: DataRecordValue, dtype: GenericDataType): string;\r\n}\r\n\r\nexport function getDataRecordFormatter({\r\n  timeFormatter,\r\n  numberFormatter,\r\n}: {\r\n  timeFormatter?: TimeFormatter;\r\n  numberFormatter?: NumberFormatter;\r\n} = {}): DataRecordValueFormatter {\r\n  return (value, dtype) => {\r\n    if (value === null || value === undefined) {\r\n      return NULL_STRING;\r\n    }\r\n    if (typeof value === 'boolean') {\r\n      return value ? TRUE_STRING : FALSE_STRING;\r\n    }\r\n    if (dtype === GenericDataType.BOOLEAN) {\r\n      try {\r\n        return JSON.parse(String(value).toLowerCase())\r\n          ? TRUE_STRING\r\n          : FALSE_STRING;\r\n      } catch {\r\n        return FALSE_STRING;\r\n      }\r\n    }\r\n    if (typeof value === 'string') {\r\n      return value;\r\n    }\r\n    if (timeFormatter && dtype === GenericDataType.TEMPORAL) {\r\n      return timeFormatter(value);\r\n    }\r\n    if (\r\n      numberFormatter &&\r\n      typeof value === 'number' &&\r\n      dtype === GenericDataType.NUMERIC\r\n    ) {\r\n      return numberFormatter(value);\r\n    }\r\n    return String(value);\r\n  };\r\n}\r\n"],"sourceRoot":""}